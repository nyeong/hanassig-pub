{"pageProps":{"note":{"title":"Nginx로 리버스 프록시","description":"Proxmox VE에 리버스 프록시 서버 세팅하기","date":"2023-03-19T00:00:00.000Z","tags":null,"body":{"raw":"\n리버스 프록시란 다른 서버의 앞단에 놓이는 프록시 서버로, 클라이언트의 요청을\n먼저 받아 여러 처리를 한 후에 필요한 서버에게 보내주는 역할을 한다.\n\n```mermaid\nsequenceDiagram\n  participant Client\n  participant ReverseProxy\n  participant Server\n  Client->>ReverseProxy: HTTP Request\n  ReverseProxy->>Server: HTTP Request\n  Server-->>ReverseProxy: HTTP Response\n  ReverseProxy-->>Client: HTTP Response\n```\n\n홈 서버에서 운영하는 서비스를 웹으로 노출시키려고 한다.\n이때 리버스 프록시를 운영하면 아래와 같은 이점이 있다.\n\n1. 보안. SSL 같은 암호화를 맡아서 처리를 할 수 있다.\n또한 내부 주소를 숨기고 도메인 주소만 노출할 수 있다.\n2. 확장. 서브 도메인을 이용하여 여러 서비스를 하나의 도메인으로 노출할 수 있다.\n3. 성능. 캐싱, 압축을 적용하여 성능에서 이득을 볼 수 있긴 한데... 얼마나\n이득일지는 잘 모르겠다.\n\n## 외부에서 홈 서버에 접속하기\n\n외부에서 내 홈서버에 접속하여 서비스를 이용하는 시나리오를 그려보자.\n\n먼저 홈 네트워크의 구성은 아래와 같다:\n\n```\n                ┌─Proxmox VE──┐\n┌───┐  ┌──────┐ │   ┌─────┐   │\n│WAN├─►│router├─┼──►│nginx│   │\n└───┘  └──────┘ │   └──┬──┘   │\n                │      ▼      │\n                │  NextCloud  │\n                └─────────────┘\n```\n\n1. 웹 브라우저에 도메인을 입력한다\n2. 이 도메인을 DNS 서버에 질의하여 IP 주소를 확인한다.\n3. 확인한 IP 주소로 HTTPS 요청을 보낸다.\n4. 라우터는 받은 모든 HTTPS 요청을 Proxmox VE의 nginx에 넘긴다.\n5. nginx는 받은 요청을 검사하여 처리 후 적절한 서비스로 넘겨준다.\n\n따라서 \n\n- 도메인을 DNS에 등록해야하고\n- 라우터에서 nginx로 포트 포워딩 해줘야하고\n- nginx에서는 서브도메인을 확인하여 원하는 서비스로 넘겨줘야 한다.\n\n먼저 nginx부터 설정하자.\n\n## Proxmox VE에 nginx 올리기\n\n리버스 프록시 역할을 수행할 수 있는 소프트웨어는 아파치 HTTP 서버, HAProxy 등\n다양하다.\n\n그 중 nginx는 설정이 간편하고 기능이 많으며 성능이 좋아 사용하기 편리하다.\n\nProxmox VE에 무언가를 올릴 때 LXC 혹은 VM으로 올릴 수 있는데, 간편하게 LXC로\n설정하였다. 사양은 최소로 잡아놓고, 필요하면 올리는 것으로.\n\n- 템플릿: fedora37-default_20221119_arm\n- 메모리: 512MB\n- 코어: 1\n- 디스크: 8GB\n- 네트워크: DHCP\n\n페도라에서 nginx는 `dnf`로 간편하게 설치할 수 있다. 서비스 관리는 `systemd`로\n한다.\n\n```\n$ dnf install nginx\n$ systemctl enable nginx\n$ systemctl start nginx\n```\n\nnginx 가동 후 `ip addr`로 내부 주소를 확인하고 접속하면 환영 페이지를 볼 수\n있다.\n\n![](/assets/fedora-nginx-start-page.png)\n\n## OpenWRT에서 포트포워딩 하기\n\n이제 외부에서 보낸 HTTP/HTTPS 요청을 nginx가 받을 수 있도록 라우터를\n설정해주어야 한다. 구체적으로는 라우터가 외부에서 받는 요청을 홈 네트워크의\n특정 포인트로 넘겨주도록 포트 포워딩 해주어야 한다.\n\nOpenWrt를 쓰는 경우, 온전한 리눅스이므로 nginx를 라우터에 직접 설치하여 쓸 수도\n있다. 추후에 설정을 자주 바꿀 필요가 없어지면 nginx로 옮기는 것도 좋겠다.\n\n- [iptime 공유기에 NGINX를 돌려봅시다.](https://svrforum.com/svr/285089)\n- [링크시스 공유기에 NGINX 올려서 Reverse Proxy로 쓰기](https://www.clien.net/service/board/use/17758656)\n\n라우터로 OpenWrt를 쓰고 있는데 OpenWrt는 Network → Port Fowarding에서\n포트 포워딩 설정을 할 수 있다.\n\n![](/assets/openwrt-port-forwarding.png)\n\n- 이름: 편한 대로 설정\n- 프로토콜: TCP. HTTP3를 고려한다면 UDP도 해야한다.\n- 소스: 외부에서 입력을 받을 것이기에 `wan` 선택\n- 외부 포트: HTTP 포트인 80, HTTPS 포트인 443을 열어준다.\n- 목적지: 내부 네트워크를 고르면 된다.\n- 내부IP: nginx를 설치한 서버의 IP\n- 내부 포트: 굳이 바꿀 필요 없이 80, 443을 쓰자\n\n포트를 한 번에 하나만 입력할 수 있으므로 두 개를 만들어야 한다.\n\n이렇게 바꾼 후 외부 IP를 확인하여 접속하면 내부에서 접속했을 때와 동일한\n화면을 볼 수 있다.\n\n## cloudflare에 DNS 등록\n\n이제 도메인 주소와 IP를 연결하면 일반적인 웹 주소로 내 홈 서비스에 접속할 수 있다.\nDNS 등록은 DNS 제공 서비스를 통해 해야하는데, 본래 쓰던 [cloudflare](https://www.cloudflare.com/)를\n이용하였다.\n\n- 타입: A\n- 이름: www, @, *\n- 주소: 내 IP주소\n- proxy: DNS only\n- TTL: auto\n\n![](/assets/cloudflare-dns-config.png)\n\nwww와 루트(@), 와일드카드(*) 세 개를 등록하자. 완료하면 이제 [nyeong.me](http://nyeong.me)로\n접속하면 IP주소로 접속했을 때와 동일한 화면을 볼 수 있다.\n\n### 레코드 종류\n\n- A 레코드\n- CNAME 레코드\n\n\n\n## Let's Encrypt로 인증서 받기\n\n지금은 http 프로토콜을 이용한 접속만 가능하다. https를 쓰려면 인증기관(CA)에서\nSSL 인증서를 발급받아야한다. 여러 CA가 있는데 그중\n[Let's Encrypt](https://letsencrypt.org/)는 무료로 인증서를 발급해준다.\n\nLet's Encrypt에 사이트를 인증하려면 ACME 프로토콜을 이용해야한다. 이를 지원하는\n[여러 클라이언트](https://letsencrypt.org/docs/client-options/)가 있는데\n\n[Cloudflare API 토큰](https://dash.cloudflare.com/profile/api-tokens)을\n발급받는다.\n\n- 권한: DNS에 대한 편집 권한\n- 리소스: DNS에 등록한 도메인 주소\n\n완료하면 API 토큰을 발급해준다. 이 토큰을 이용하여 SSL 인증서를 발급받을 것이다.\n\n```\n$ dnf install git openssl\n$ git clone https://github.com/acmesh-official/acme.sh.git\n$ cd ./acme.sh\n$ mkdir /etc/nginx/ssl/\n$ ./acme.sh --install --force -m me@annyeong.me\n$ export CF_Token=\"위에서 발급받은 토큰\"\n$ export CF_Email=\"cloudflare 이메일\"\n$ acme.sh --issue \\\n          --dns dns_cf \\\n          --server letsencrypt \\\n          -d nyeong.me -d '*.nyeong.me' \\\n          --keylength ec-256 \\\n          --key-file /etc/nginx/ssl/privkey.pem \\\n          --fullchain-file /etc/nginx/ssl/fullchain.pem \\\n          --cert-file /etc/nginx/ssl/chain.pem \\\n          --reloadcmd \"systemctl reload nginx.service\"\n```\n\n- acme.sh는 install 할 때 cron이 존재하는지 검사한다. 페도라는 `systemd`를\n이용하므로 cron이 없으므로 `--force` 명령어로 진행시킨다.\n`acme.sh --cron`\n\n이후 `acme.sh list` 확인하면 잘 발급되었음을 볼 수 있다.\n\n```\n$ acme.sh list\nMain_Domain  KeyLength  SAN_Domains  CA               Created               Renew\nnyeong.me    \"ec-256\"   *.nyeong.me  LetsEncrypt.org  2023-03-20T05:03:49Z  2023-05-18T05:03:49Z\n```\n\nSSL 설정은 모질라의\n[SSL Configuration Generator](https://ssl-config.mozilla.org/#server=nginx&version=1.22.1&config=modern&openssl=3.0.5&guideline=5.6)를\n이용하였다.\n\n\n```\nserver {\n\t\tlisten       443 ssl http2;\n\t\tlisten       [::]:443 ssl http2;\n\t\tserver_name  _;\n\t\troot         /usr/share/nginx/html;\n\n\t\tssl_certificate \"/etc/nginx/ssl/fullchain.pem\";\n\t\tssl_certificate_key \"/etc/nginx/ssl/privkey.pem\";\n\t\tssl_trusted_certificate /etc/nginx/ssl/chain.pem;\n\t\tssl_session_cache shared:MozSSL:10m;\n\t\tssl_session_timeout  1d;\n\t\tssl_session_tickets off;\n\n\t\tssl_protocols TLSv1.3;\n\t\tssl_prefer_server_ciphers off;\n\n\t\tadd_header Strict-Transport-Security \"max-age=63072000\" always;\n\n\t\t# OCSP stapling\n\t\tssl_stapling on;\n\t\tssl_stapling_verify on;\n\n\t\t# verify chain of trust of OCSP response using Root CA and Intermediate certs\n\n\t\t# replace with the IP address of your resolver\n\t\tresolver 127.0.0.1;\n}\n```\n\n### 리버스 프록시\nㅈ\n\n### nextcloud\n\nocc 실행\n\n```\nsu www-data -s /usr/bin/php /var/www/nextcloud/occ\n```\n","code":"var Component=(()=>{var a=Object.create;var c=Object.defineProperty;var p=Object.getOwnPropertyDescriptor;var g=Object.getOwnPropertyNames;var m=Object.getPrototypeOf,x=Object.prototype.hasOwnProperty;var f=(r,n)=>()=>(n||r((n={exports:{}}).exports,n),n.exports),u=(r,n)=>{for(var i in n)c(r,i,{get:n[i],enumerable:!0})},s=(r,n,i,t)=>{if(n&&typeof n==\"object\"||typeof n==\"function\")for(let l of g(n))!x.call(r,l)&&l!==i&&c(r,l,{get:()=>n[l],enumerable:!(t=p(n,l))||t.enumerable});return r};var P=(r,n,i)=>(i=r!=null?a(m(r)):{},s(n||!r||!r.__esModule?c(i,\"default\",{value:r,enumerable:!0}):i,r)),y=r=>s(c({},\"__esModule\",{value:!0}),r);var h=f((C,d)=>{d.exports=_jsx_runtime});var w={};u(w,{default:()=>T,frontmatter:()=>_});var e=P(h()),_={title:\"Nginx\\uB85C \\uB9AC\\uBC84\\uC2A4 \\uD504\\uB85D\\uC2DC\",description:\"Proxmox VE\\uC5D0 \\uB9AC\\uBC84\\uC2A4 \\uD504\\uB85D\\uC2DC \\uC11C\\uBC84 \\uC138\\uD305\\uD558\\uAE30\",date:new Date(1679184e6),tags:null};function o(r){let n=Object.assign({p:\"p\",pre:\"pre\",code:\"code\",ol:\"ol\",li:\"li\",h2:\"h2\",ul:\"ul\",img:\"img\",a:\"a\",h3:\"h3\"},r.components);return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(n.p,{children:`\\uB9AC\\uBC84\\uC2A4 \\uD504\\uB85D\\uC2DC\\uB780 \\uB2E4\\uB978 \\uC11C\\uBC84\\uC758 \\uC55E\\uB2E8\\uC5D0 \\uB193\\uC774\\uB294 \\uD504\\uB85D\\uC2DC \\uC11C\\uBC84\\uB85C, \\uD074\\uB77C\\uC774\\uC5B8\\uD2B8\\uC758 \\uC694\\uCCAD\\uC744\n\\uBA3C\\uC800 \\uBC1B\\uC544 \\uC5EC\\uB7EC \\uCC98\\uB9AC\\uB97C \\uD55C \\uD6C4\\uC5D0 \\uD544\\uC694\\uD55C \\uC11C\\uBC84\\uC5D0\\uAC8C \\uBCF4\\uB0B4\\uC8FC\\uB294 \\uC5ED\\uD560\\uC744 \\uD55C\\uB2E4.`}),`\n`,(0,e.jsx)(n.pre,{children:(0,e.jsx)(n.code,{className:\"language-mermaid\",children:`sequenceDiagram\n  participant Client\n  participant ReverseProxy\n  participant Server\n  Client->>ReverseProxy: HTTP Request\n  ReverseProxy->>Server: HTTP Request\n  Server-->>ReverseProxy: HTTP Response\n  ReverseProxy-->>Client: HTTP Response\n`})}),`\n`,(0,e.jsx)(n.p,{children:`\\uD648 \\uC11C\\uBC84\\uC5D0\\uC11C \\uC6B4\\uC601\\uD558\\uB294 \\uC11C\\uBE44\\uC2A4\\uB97C \\uC6F9\\uC73C\\uB85C \\uB178\\uCD9C\\uC2DC\\uD0A4\\uB824\\uACE0 \\uD55C\\uB2E4.\n\\uC774\\uB54C \\uB9AC\\uBC84\\uC2A4 \\uD504\\uB85D\\uC2DC\\uB97C \\uC6B4\\uC601\\uD558\\uBA74 \\uC544\\uB798\\uC640 \\uAC19\\uC740 \\uC774\\uC810\\uC774 \\uC788\\uB2E4.`}),`\n`,(0,e.jsxs)(n.ol,{children:[`\n`,(0,e.jsx)(n.li,{children:`\\uBCF4\\uC548. SSL \\uAC19\\uC740 \\uC554\\uD638\\uD654\\uB97C \\uB9E1\\uC544\\uC11C \\uCC98\\uB9AC\\uB97C \\uD560 \\uC218 \\uC788\\uB2E4.\n\\uB610\\uD55C \\uB0B4\\uBD80 \\uC8FC\\uC18C\\uB97C \\uC228\\uAE30\\uACE0 \\uB3C4\\uBA54\\uC778 \\uC8FC\\uC18C\\uB9CC \\uB178\\uCD9C\\uD560 \\uC218 \\uC788\\uB2E4.`}),`\n`,(0,e.jsx)(n.li,{children:\"\\uD655\\uC7A5. \\uC11C\\uBE0C \\uB3C4\\uBA54\\uC778\\uC744 \\uC774\\uC6A9\\uD558\\uC5EC \\uC5EC\\uB7EC \\uC11C\\uBE44\\uC2A4\\uB97C \\uD558\\uB098\\uC758 \\uB3C4\\uBA54\\uC778\\uC73C\\uB85C \\uB178\\uCD9C\\uD560 \\uC218 \\uC788\\uB2E4.\"}),`\n`,(0,e.jsx)(n.li,{children:`\\uC131\\uB2A5. \\uCE90\\uC2F1, \\uC555\\uCD95\\uC744 \\uC801\\uC6A9\\uD558\\uC5EC \\uC131\\uB2A5\\uC5D0\\uC11C \\uC774\\uB4DD\\uC744 \\uBCFC \\uC218 \\uC788\\uAE34 \\uD55C\\uB370... \\uC5BC\\uB9C8\\uB098\n\\uC774\\uB4DD\\uC77C\\uC9C0\\uB294 \\uC798 \\uBAA8\\uB974\\uACA0\\uB2E4.`}),`\n`]}),`\n`,(0,e.jsx)(n.h2,{children:\"\\uC678\\uBD80\\uC5D0\\uC11C \\uD648 \\uC11C\\uBC84\\uC5D0 \\uC811\\uC18D\\uD558\\uAE30\"}),`\n`,(0,e.jsx)(n.p,{children:\"\\uC678\\uBD80\\uC5D0\\uC11C \\uB0B4 \\uD648\\uC11C\\uBC84\\uC5D0 \\uC811\\uC18D\\uD558\\uC5EC \\uC11C\\uBE44\\uC2A4\\uB97C \\uC774\\uC6A9\\uD558\\uB294 \\uC2DC\\uB098\\uB9AC\\uC624\\uB97C \\uADF8\\uB824\\uBCF4\\uC790.\"}),`\n`,(0,e.jsx)(n.p,{children:\"\\uBA3C\\uC800 \\uD648 \\uB124\\uD2B8\\uC6CC\\uD06C\\uC758 \\uAD6C\\uC131\\uC740 \\uC544\\uB798\\uC640 \\uAC19\\uB2E4:\"}),`\n`,(0,e.jsx)(n.pre,{children:(0,e.jsx)(n.code,{children:`                \\u250C\\u2500Proxmox VE\\u2500\\u2500\\u2510\n\\u250C\\u2500\\u2500\\u2500\\u2510  \\u250C\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2510 \\u2502   \\u250C\\u2500\\u2500\\u2500\\u2500\\u2500\\u2510   \\u2502\n\\u2502WAN\\u251C\\u2500\\u25BA\\u2502router\\u251C\\u2500\\u253C\\u2500\\u2500\\u25BA\\u2502nginx\\u2502   \\u2502\n\\u2514\\u2500\\u2500\\u2500\\u2518  \\u2514\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2518 \\u2502   \\u2514\\u2500\\u2500\\u252C\\u2500\\u2500\\u2518   \\u2502\n                \\u2502      \\u25BC      \\u2502\n                \\u2502  NextCloud  \\u2502\n                \\u2514\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2518\n`})}),`\n`,(0,e.jsxs)(n.ol,{children:[`\n`,(0,e.jsx)(n.li,{children:\"\\uC6F9 \\uBE0C\\uB77C\\uC6B0\\uC800\\uC5D0 \\uB3C4\\uBA54\\uC778\\uC744 \\uC785\\uB825\\uD55C\\uB2E4\"}),`\n`,(0,e.jsx)(n.li,{children:\"\\uC774 \\uB3C4\\uBA54\\uC778\\uC744 DNS \\uC11C\\uBC84\\uC5D0 \\uC9C8\\uC758\\uD558\\uC5EC IP \\uC8FC\\uC18C\\uB97C \\uD655\\uC778\\uD55C\\uB2E4.\"}),`\n`,(0,e.jsx)(n.li,{children:\"\\uD655\\uC778\\uD55C IP \\uC8FC\\uC18C\\uB85C HTTPS \\uC694\\uCCAD\\uC744 \\uBCF4\\uB0B8\\uB2E4.\"}),`\n`,(0,e.jsx)(n.li,{children:\"\\uB77C\\uC6B0\\uD130\\uB294 \\uBC1B\\uC740 \\uBAA8\\uB4E0 HTTPS \\uC694\\uCCAD\\uC744 Proxmox VE\\uC758 nginx\\uC5D0 \\uB118\\uAE34\\uB2E4.\"}),`\n`,(0,e.jsx)(n.li,{children:\"nginx\\uB294 \\uBC1B\\uC740 \\uC694\\uCCAD\\uC744 \\uAC80\\uC0AC\\uD558\\uC5EC \\uCC98\\uB9AC \\uD6C4 \\uC801\\uC808\\uD55C \\uC11C\\uBE44\\uC2A4\\uB85C \\uB118\\uACA8\\uC900\\uB2E4.\"}),`\n`]}),`\n`,(0,e.jsx)(n.p,{children:\"\\uB530\\uB77C\\uC11C\"}),`\n`,(0,e.jsxs)(n.ul,{children:[`\n`,(0,e.jsx)(n.li,{children:\"\\uB3C4\\uBA54\\uC778\\uC744 DNS\\uC5D0 \\uB4F1\\uB85D\\uD574\\uC57C\\uD558\\uACE0\"}),`\n`,(0,e.jsx)(n.li,{children:\"\\uB77C\\uC6B0\\uD130\\uC5D0\\uC11C nginx\\uB85C \\uD3EC\\uD2B8 \\uD3EC\\uC6CC\\uB529 \\uD574\\uC918\\uC57C\\uD558\\uACE0\"}),`\n`,(0,e.jsx)(n.li,{children:\"nginx\\uC5D0\\uC11C\\uB294 \\uC11C\\uBE0C\\uB3C4\\uBA54\\uC778\\uC744 \\uD655\\uC778\\uD558\\uC5EC \\uC6D0\\uD558\\uB294 \\uC11C\\uBE44\\uC2A4\\uB85C \\uB118\\uACA8\\uC918\\uC57C \\uD55C\\uB2E4.\"}),`\n`]}),`\n`,(0,e.jsx)(n.p,{children:\"\\uBA3C\\uC800 nginx\\uBD80\\uD130 \\uC124\\uC815\\uD558\\uC790.\"}),`\n`,(0,e.jsx)(n.h2,{children:\"Proxmox VE\\uC5D0 nginx \\uC62C\\uB9AC\\uAE30\"}),`\n`,(0,e.jsx)(n.p,{children:`\\uB9AC\\uBC84\\uC2A4 \\uD504\\uB85D\\uC2DC \\uC5ED\\uD560\\uC744 \\uC218\\uD589\\uD560 \\uC218 \\uC788\\uB294 \\uC18C\\uD504\\uD2B8\\uC6E8\\uC5B4\\uB294 \\uC544\\uD30C\\uCE58 HTTP \\uC11C\\uBC84, HAProxy \\uB4F1\n\\uB2E4\\uC591\\uD558\\uB2E4.`}),`\n`,(0,e.jsx)(n.p,{children:\"\\uADF8 \\uC911 nginx\\uB294 \\uC124\\uC815\\uC774 \\uAC04\\uD3B8\\uD558\\uACE0 \\uAE30\\uB2A5\\uC774 \\uB9CE\\uC73C\\uBA70 \\uC131\\uB2A5\\uC774 \\uC88B\\uC544 \\uC0AC\\uC6A9\\uD558\\uAE30 \\uD3B8\\uB9AC\\uD558\\uB2E4.\"}),`\n`,(0,e.jsx)(n.p,{children:`Proxmox VE\\uC5D0 \\uBB34\\uC5B8\\uAC00\\uB97C \\uC62C\\uB9B4 \\uB54C LXC \\uD639\\uC740 VM\\uC73C\\uB85C \\uC62C\\uB9B4 \\uC218 \\uC788\\uB294\\uB370, \\uAC04\\uD3B8\\uD558\\uAC8C LXC\\uB85C\n\\uC124\\uC815\\uD558\\uC600\\uB2E4. \\uC0AC\\uC591\\uC740 \\uCD5C\\uC18C\\uB85C \\uC7A1\\uC544\\uB193\\uACE0, \\uD544\\uC694\\uD558\\uBA74 \\uC62C\\uB9AC\\uB294 \\uAC83\\uC73C\\uB85C.`}),`\n`,(0,e.jsxs)(n.ul,{children:[`\n`,(0,e.jsx)(n.li,{children:\"\\uD15C\\uD50C\\uB9BF: fedora37-default_20221119_arm\"}),`\n`,(0,e.jsx)(n.li,{children:\"\\uBA54\\uBAA8\\uB9AC: 512MB\"}),`\n`,(0,e.jsx)(n.li,{children:\"\\uCF54\\uC5B4: 1\"}),`\n`,(0,e.jsx)(n.li,{children:\"\\uB514\\uC2A4\\uD06C: 8GB\"}),`\n`,(0,e.jsx)(n.li,{children:\"\\uB124\\uD2B8\\uC6CC\\uD06C: DHCP\"}),`\n`]}),`\n`,(0,e.jsxs)(n.p,{children:[\"\\uD398\\uB3C4\\uB77C\\uC5D0\\uC11C nginx\\uB294 \",(0,e.jsx)(n.code,{children:\"dnf\"}),\"\\uB85C \\uAC04\\uD3B8\\uD558\\uAC8C \\uC124\\uCE58\\uD560 \\uC218 \\uC788\\uB2E4. \\uC11C\\uBE44\\uC2A4 \\uAD00\\uB9AC\\uB294 \",(0,e.jsx)(n.code,{children:\"systemd\"}),`\\uB85C\n\\uD55C\\uB2E4.`]}),`\n`,(0,e.jsx)(n.pre,{children:(0,e.jsx)(n.code,{children:`$ dnf install nginx\n$ systemctl enable nginx\n$ systemctl start nginx\n`})}),`\n`,(0,e.jsxs)(n.p,{children:[\"nginx \\uAC00\\uB3D9 \\uD6C4 \",(0,e.jsx)(n.code,{children:\"ip addr\"}),`\\uB85C \\uB0B4\\uBD80 \\uC8FC\\uC18C\\uB97C \\uD655\\uC778\\uD558\\uACE0 \\uC811\\uC18D\\uD558\\uBA74 \\uD658\\uC601 \\uD398\\uC774\\uC9C0\\uB97C \\uBCFC \\uC218\n\\uC788\\uB2E4.`]}),`\n`,(0,e.jsx)(n.p,{children:(0,e.jsx)(n.img,{src:\"/assets/fedora-nginx-start-page.png\",alt:\"\"})}),`\n`,(0,e.jsx)(n.h2,{children:\"OpenWRT\\uC5D0\\uC11C \\uD3EC\\uD2B8\\uD3EC\\uC6CC\\uB529 \\uD558\\uAE30\"}),`\n`,(0,e.jsx)(n.p,{children:`\\uC774\\uC81C \\uC678\\uBD80\\uC5D0\\uC11C \\uBCF4\\uB0B8 HTTP/HTTPS \\uC694\\uCCAD\\uC744 nginx\\uAC00 \\uBC1B\\uC744 \\uC218 \\uC788\\uB3C4\\uB85D \\uB77C\\uC6B0\\uD130\\uB97C\n\\uC124\\uC815\\uD574\\uC8FC\\uC5B4\\uC57C \\uD55C\\uB2E4. \\uAD6C\\uCCB4\\uC801\\uC73C\\uB85C\\uB294 \\uB77C\\uC6B0\\uD130\\uAC00 \\uC678\\uBD80\\uC5D0\\uC11C \\uBC1B\\uB294 \\uC694\\uCCAD\\uC744 \\uD648 \\uB124\\uD2B8\\uC6CC\\uD06C\\uC758\n\\uD2B9\\uC815 \\uD3EC\\uC778\\uD2B8\\uB85C \\uB118\\uACA8\\uC8FC\\uB3C4\\uB85D \\uD3EC\\uD2B8 \\uD3EC\\uC6CC\\uB529 \\uD574\\uC8FC\\uC5B4\\uC57C \\uD55C\\uB2E4.`}),`\n`,(0,e.jsx)(n.p,{children:`OpenWrt\\uB97C \\uC4F0\\uB294 \\uACBD\\uC6B0, \\uC628\\uC804\\uD55C \\uB9AC\\uB205\\uC2A4\\uC774\\uBBC0\\uB85C nginx\\uB97C \\uB77C\\uC6B0\\uD130\\uC5D0 \\uC9C1\\uC811 \\uC124\\uCE58\\uD558\\uC5EC \\uC4F8 \\uC218\\uB3C4\n\\uC788\\uB2E4. \\uCD94\\uD6C4\\uC5D0 \\uC124\\uC815\\uC744 \\uC790\\uC8FC \\uBC14\\uAFC0 \\uD544\\uC694\\uAC00 \\uC5C6\\uC5B4\\uC9C0\\uBA74 nginx\\uB85C \\uC62E\\uAE30\\uB294 \\uAC83\\uB3C4 \\uC88B\\uACA0\\uB2E4.`}),`\n`,(0,e.jsxs)(n.ul,{children:[`\n`,(0,e.jsx)(n.li,{children:(0,e.jsx)(n.a,{href:\"https://svrforum.com/svr/285089\",children:\"iptime \\uACF5\\uC720\\uAE30\\uC5D0 NGINX\\uB97C \\uB3CC\\uB824\\uBD05\\uC2DC\\uB2E4.\"})}),`\n`,(0,e.jsx)(n.li,{children:(0,e.jsx)(n.a,{href:\"https://www.clien.net/service/board/use/17758656\",children:\"\\uB9C1\\uD06C\\uC2DC\\uC2A4 \\uACF5\\uC720\\uAE30\\uC5D0 NGINX \\uC62C\\uB824\\uC11C Reverse Proxy\\uB85C \\uC4F0\\uAE30\"})}),`\n`]}),`\n`,(0,e.jsx)(n.p,{children:`\\uB77C\\uC6B0\\uD130\\uB85C OpenWrt\\uB97C \\uC4F0\\uACE0 \\uC788\\uB294\\uB370 OpenWrt\\uB294 Network \\u2192 Port Fowarding\\uC5D0\\uC11C\n\\uD3EC\\uD2B8 \\uD3EC\\uC6CC\\uB529 \\uC124\\uC815\\uC744 \\uD560 \\uC218 \\uC788\\uB2E4.`}),`\n`,(0,e.jsx)(n.p,{children:(0,e.jsx)(n.img,{src:\"/assets/openwrt-port-forwarding.png\",alt:\"\"})}),`\n`,(0,e.jsxs)(n.ul,{children:[`\n`,(0,e.jsx)(n.li,{children:\"\\uC774\\uB984: \\uD3B8\\uD55C \\uB300\\uB85C \\uC124\\uC815\"}),`\n`,(0,e.jsx)(n.li,{children:\"\\uD504\\uB85C\\uD1A0\\uCF5C: TCP. HTTP3\\uB97C \\uACE0\\uB824\\uD55C\\uB2E4\\uBA74 UDP\\uB3C4 \\uD574\\uC57C\\uD55C\\uB2E4.\"}),`\n`,(0,e.jsxs)(n.li,{children:[\"\\uC18C\\uC2A4: \\uC678\\uBD80\\uC5D0\\uC11C \\uC785\\uB825\\uC744 \\uBC1B\\uC744 \\uAC83\\uC774\\uAE30\\uC5D0 \",(0,e.jsx)(n.code,{children:\"wan\"}),\" \\uC120\\uD0DD\"]}),`\n`,(0,e.jsx)(n.li,{children:\"\\uC678\\uBD80 \\uD3EC\\uD2B8: HTTP \\uD3EC\\uD2B8\\uC778 80, HTTPS \\uD3EC\\uD2B8\\uC778 443\\uC744 \\uC5F4\\uC5B4\\uC900\\uB2E4.\"}),`\n`,(0,e.jsx)(n.li,{children:\"\\uBAA9\\uC801\\uC9C0: \\uB0B4\\uBD80 \\uB124\\uD2B8\\uC6CC\\uD06C\\uB97C \\uACE0\\uB974\\uBA74 \\uB41C\\uB2E4.\"}),`\n`,(0,e.jsx)(n.li,{children:\"\\uB0B4\\uBD80IP: nginx\\uB97C \\uC124\\uCE58\\uD55C \\uC11C\\uBC84\\uC758 IP\"}),`\n`,(0,e.jsx)(n.li,{children:\"\\uB0B4\\uBD80 \\uD3EC\\uD2B8: \\uAD73\\uC774 \\uBC14\\uAFC0 \\uD544\\uC694 \\uC5C6\\uC774 80, 443\\uC744 \\uC4F0\\uC790\"}),`\n`]}),`\n`,(0,e.jsx)(n.p,{children:\"\\uD3EC\\uD2B8\\uB97C \\uD55C \\uBC88\\uC5D0 \\uD558\\uB098\\uB9CC \\uC785\\uB825\\uD560 \\uC218 \\uC788\\uC73C\\uBBC0\\uB85C \\uB450 \\uAC1C\\uB97C \\uB9CC\\uB4E4\\uC5B4\\uC57C \\uD55C\\uB2E4.\"}),`\n`,(0,e.jsx)(n.p,{children:`\\uC774\\uB807\\uAC8C \\uBC14\\uAFBC \\uD6C4 \\uC678\\uBD80 IP\\uB97C \\uD655\\uC778\\uD558\\uC5EC \\uC811\\uC18D\\uD558\\uBA74 \\uB0B4\\uBD80\\uC5D0\\uC11C \\uC811\\uC18D\\uD588\\uC744 \\uB54C\\uC640 \\uB3D9\\uC77C\\uD55C\n\\uD654\\uBA74\\uC744 \\uBCFC \\uC218 \\uC788\\uB2E4.`}),`\n`,(0,e.jsx)(n.h2,{children:\"cloudflare\\uC5D0 DNS \\uB4F1\\uB85D\"}),`\n`,(0,e.jsxs)(n.p,{children:[`\\uC774\\uC81C \\uB3C4\\uBA54\\uC778 \\uC8FC\\uC18C\\uC640 IP\\uB97C \\uC5F0\\uACB0\\uD558\\uBA74 \\uC77C\\uBC18\\uC801\\uC778 \\uC6F9 \\uC8FC\\uC18C\\uB85C \\uB0B4 \\uD648 \\uC11C\\uBE44\\uC2A4\\uC5D0 \\uC811\\uC18D\\uD560 \\uC218 \\uC788\\uB2E4.\nDNS \\uB4F1\\uB85D\\uC740 DNS \\uC81C\\uACF5 \\uC11C\\uBE44\\uC2A4\\uB97C \\uD1B5\\uD574 \\uD574\\uC57C\\uD558\\uB294\\uB370, \\uBCF8\\uB798 \\uC4F0\\uB358 `,(0,e.jsx)(n.a,{href:\"https://www.cloudflare.com/\",children:\"cloudflare\"}),`\\uB97C\n\\uC774\\uC6A9\\uD558\\uC600\\uB2E4.`]}),`\n`,(0,e.jsxs)(n.ul,{children:[`\n`,(0,e.jsx)(n.li,{children:\"\\uD0C0\\uC785: A\"}),`\n`,(0,e.jsx)(n.li,{children:\"\\uC774\\uB984: www, @, *\"}),`\n`,(0,e.jsx)(n.li,{children:\"\\uC8FC\\uC18C: \\uB0B4 IP\\uC8FC\\uC18C\"}),`\n`,(0,e.jsx)(n.li,{children:\"proxy: DNS only\"}),`\n`,(0,e.jsx)(n.li,{children:\"TTL: auto\"}),`\n`]}),`\n`,(0,e.jsx)(n.p,{children:(0,e.jsx)(n.img,{src:\"/assets/cloudflare-dns-config.png\",alt:\"\"})}),`\n`,(0,e.jsxs)(n.p,{children:[\"www\\uC640 \\uB8E8\\uD2B8(@), \\uC640\\uC77C\\uB4DC\\uCE74\\uB4DC(*) \\uC138 \\uAC1C\\uB97C \\uB4F1\\uB85D\\uD558\\uC790. \\uC644\\uB8CC\\uD558\\uBA74 \\uC774\\uC81C \",(0,e.jsx)(n.a,{href:\"http://nyeong.me\",children:\"nyeong.me\"}),`\\uB85C\n\\uC811\\uC18D\\uD558\\uBA74 IP\\uC8FC\\uC18C\\uB85C \\uC811\\uC18D\\uD588\\uC744 \\uB54C\\uC640 \\uB3D9\\uC77C\\uD55C \\uD654\\uBA74\\uC744 \\uBCFC \\uC218 \\uC788\\uB2E4.`]}),`\n`,(0,e.jsx)(n.h3,{children:\"\\uB808\\uCF54\\uB4DC \\uC885\\uB958\"}),`\n`,(0,e.jsxs)(n.ul,{children:[`\n`,(0,e.jsx)(n.li,{children:\"A \\uB808\\uCF54\\uB4DC\"}),`\n`,(0,e.jsx)(n.li,{children:\"CNAME \\uB808\\uCF54\\uB4DC\"}),`\n`]}),`\n`,(0,e.jsx)(n.h2,{children:\"Let's Encrypt\\uB85C \\uC778\\uC99D\\uC11C \\uBC1B\\uAE30\"}),`\n`,(0,e.jsxs)(n.p,{children:[`\\uC9C0\\uAE08\\uC740 http \\uD504\\uB85C\\uD1A0\\uCF5C\\uC744 \\uC774\\uC6A9\\uD55C \\uC811\\uC18D\\uB9CC \\uAC00\\uB2A5\\uD558\\uB2E4. https\\uB97C \\uC4F0\\uB824\\uBA74 \\uC778\\uC99D\\uAE30\\uAD00(CA)\\uC5D0\\uC11C\nSSL \\uC778\\uC99D\\uC11C\\uB97C \\uBC1C\\uAE09\\uBC1B\\uC544\\uC57C\\uD55C\\uB2E4. \\uC5EC\\uB7EC CA\\uAC00 \\uC788\\uB294\\uB370 \\uADF8\\uC911\n`,(0,e.jsx)(n.a,{href:\"https://letsencrypt.org/\",children:\"Let's Encrypt\"}),\"\\uB294 \\uBB34\\uB8CC\\uB85C \\uC778\\uC99D\\uC11C\\uB97C \\uBC1C\\uAE09\\uD574\\uC900\\uB2E4.\"]}),`\n`,(0,e.jsxs)(n.p,{children:[`Let's Encrypt\\uC5D0 \\uC0AC\\uC774\\uD2B8\\uB97C \\uC778\\uC99D\\uD558\\uB824\\uBA74 ACME \\uD504\\uB85C\\uD1A0\\uCF5C\\uC744 \\uC774\\uC6A9\\uD574\\uC57C\\uD55C\\uB2E4. \\uC774\\uB97C \\uC9C0\\uC6D0\\uD558\\uB294\n`,(0,e.jsx)(n.a,{href:\"https://letsencrypt.org/docs/client-options/\",children:\"\\uC5EC\\uB7EC \\uD074\\uB77C\\uC774\\uC5B8\\uD2B8\"}),\"\\uAC00 \\uC788\\uB294\\uB370\"]}),`\n`,(0,e.jsxs)(n.p,{children:[(0,e.jsx)(n.a,{href:\"https://dash.cloudflare.com/profile/api-tokens\",children:\"Cloudflare API \\uD1A0\\uD070\"}),`\\uC744\n\\uBC1C\\uAE09\\uBC1B\\uB294\\uB2E4.`]}),`\n`,(0,e.jsxs)(n.ul,{children:[`\n`,(0,e.jsx)(n.li,{children:\"\\uAD8C\\uD55C: DNS\\uC5D0 \\uB300\\uD55C \\uD3B8\\uC9D1 \\uAD8C\\uD55C\"}),`\n`,(0,e.jsx)(n.li,{children:\"\\uB9AC\\uC18C\\uC2A4: DNS\\uC5D0 \\uB4F1\\uB85D\\uD55C \\uB3C4\\uBA54\\uC778 \\uC8FC\\uC18C\"}),`\n`]}),`\n`,(0,e.jsx)(n.p,{children:\"\\uC644\\uB8CC\\uD558\\uBA74 API \\uD1A0\\uD070\\uC744 \\uBC1C\\uAE09\\uD574\\uC900\\uB2E4. \\uC774 \\uD1A0\\uD070\\uC744 \\uC774\\uC6A9\\uD558\\uC5EC SSL \\uC778\\uC99D\\uC11C\\uB97C \\uBC1C\\uAE09\\uBC1B\\uC744 \\uAC83\\uC774\\uB2E4.\"}),`\n`,(0,e.jsx)(n.pre,{children:(0,e.jsx)(n.code,{children:`$ dnf install git openssl\n$ git clone https://github.com/acmesh-official/acme.sh.git\n$ cd ./acme.sh\n$ mkdir /etc/nginx/ssl/\n$ ./acme.sh --install --force -m me@annyeong.me\n$ export CF_Token=\"\\uC704\\uC5D0\\uC11C \\uBC1C\\uAE09\\uBC1B\\uC740 \\uD1A0\\uD070\"\n$ export CF_Email=\"cloudflare \\uC774\\uBA54\\uC77C\"\n$ acme.sh --issue \\\\\n          --dns dns_cf \\\\\n          --server letsencrypt \\\\\n          -d nyeong.me -d '*.nyeong.me' \\\\\n          --keylength ec-256 \\\\\n          --key-file /etc/nginx/ssl/privkey.pem \\\\\n          --fullchain-file /etc/nginx/ssl/fullchain.pem \\\\\n          --cert-file /etc/nginx/ssl/chain.pem \\\\\n          --reloadcmd \"systemctl reload nginx.service\"\n`})}),`\n`,(0,e.jsxs)(n.ul,{children:[`\n`,(0,e.jsxs)(n.li,{children:[\"acme.sh\\uB294 install \\uD560 \\uB54C cron\\uC774 \\uC874\\uC7AC\\uD558\\uB294\\uC9C0 \\uAC80\\uC0AC\\uD55C\\uB2E4. \\uD398\\uB3C4\\uB77C\\uB294 \",(0,e.jsx)(n.code,{children:\"systemd\"}),`\\uB97C\n\\uC774\\uC6A9\\uD558\\uBBC0\\uB85C cron\\uC774 \\uC5C6\\uC73C\\uBBC0\\uB85C `,(0,e.jsx)(n.code,{children:\"--force\"}),` \\uBA85\\uB839\\uC5B4\\uB85C \\uC9C4\\uD589\\uC2DC\\uD0A8\\uB2E4.\n`,(0,e.jsx)(n.code,{children:\"acme.sh --cron\"})]}),`\n`]}),`\n`,(0,e.jsxs)(n.p,{children:[\"\\uC774\\uD6C4 \",(0,e.jsx)(n.code,{children:\"acme.sh list\"}),\" \\uD655\\uC778\\uD558\\uBA74 \\uC798 \\uBC1C\\uAE09\\uB418\\uC5C8\\uC74C\\uC744 \\uBCFC \\uC218 \\uC788\\uB2E4.\"]}),`\n`,(0,e.jsx)(n.pre,{children:(0,e.jsx)(n.code,{children:`$ acme.sh list\nMain_Domain  KeyLength  SAN_Domains  CA               Created               Renew\nnyeong.me    \"ec-256\"   *.nyeong.me  LetsEncrypt.org  2023-03-20T05:03:49Z  2023-05-18T05:03:49Z\n`})}),`\n`,(0,e.jsxs)(n.p,{children:[`SSL \\uC124\\uC815\\uC740 \\uBAA8\\uC9C8\\uB77C\\uC758\n`,(0,e.jsx)(n.a,{href:\"https://ssl-config.mozilla.org/#server=nginx&version=1.22.1&config=modern&openssl=3.0.5&guideline=5.6\",children:\"SSL Configuration Generator\"}),`\\uB97C\n\\uC774\\uC6A9\\uD558\\uC600\\uB2E4.`]}),`\n`,(0,e.jsx)(n.pre,{children:(0,e.jsx)(n.code,{children:`server {\n\t\tlisten       443 ssl http2;\n\t\tlisten       [::]:443 ssl http2;\n\t\tserver_name  _;\n\t\troot         /usr/share/nginx/html;\n\n\t\tssl_certificate \"/etc/nginx/ssl/fullchain.pem\";\n\t\tssl_certificate_key \"/etc/nginx/ssl/privkey.pem\";\n\t\tssl_trusted_certificate /etc/nginx/ssl/chain.pem;\n\t\tssl_session_cache shared:MozSSL:10m;\n\t\tssl_session_timeout  1d;\n\t\tssl_session_tickets off;\n\n\t\tssl_protocols TLSv1.3;\n\t\tssl_prefer_server_ciphers off;\n\n\t\tadd_header Strict-Transport-Security \"max-age=63072000\" always;\n\n\t\t# OCSP stapling\n\t\tssl_stapling on;\n\t\tssl_stapling_verify on;\n\n\t\t# verify chain of trust of OCSP response using Root CA and Intermediate certs\n\n\t\t# replace with the IP address of your resolver\n\t\tresolver 127.0.0.1;\n}\n`})}),`\n`,(0,e.jsx)(n.h3,{children:\"\\uB9AC\\uBC84\\uC2A4 \\uD504\\uB85D\\uC2DC\"}),`\n`,(0,e.jsx)(n.p,{children:\"\\u3148\"}),`\n`,(0,e.jsx)(n.h3,{children:\"nextcloud\"}),`\n`,(0,e.jsx)(n.p,{children:\"occ \\uC2E4\\uD589\"}),`\n`,(0,e.jsx)(n.pre,{children:(0,e.jsx)(n.code,{children:`su www-data -s /usr/bin/php /var/www/nextcloud/occ\n`})})]})}function S(r={}){let{wrapper:n}=r.components||{};return n?(0,e.jsx)(n,Object.assign({},r,{children:(0,e.jsx)(o,r)})):o(r)}var T=S;return y(w);})();\n;return Component;"},"_id":"nginx-reverse-proxy.md","_raw":{"sourceFilePath":"nginx-reverse-proxy.md","sourceFileName":"nginx-reverse-proxy.md","sourceFileDir":".","contentType":"markdown","flattenedPath":"nginx-reverse-proxy"},"type":"Note","slug":"nginx-reverse-proxy"}},"__N_SSG":true}