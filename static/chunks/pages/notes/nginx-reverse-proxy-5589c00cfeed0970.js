(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9526],{2653:function(e,n,s){(window.__NEXT_P=window.__NEXT_P||[]).push(["/notes/nginx-reverse-proxy",function(){return s(1701)}])},2219:function(e,n,s){"use strict";var t=s(1527);n.Z={logo:(0,t.jsx)("span",{children:"하나씩"}),project:{link:"https://h.annyeong.me"}}},1701:function(e,n,s){"use strict";s.r(n),s.d(n,{default:function(){return j}});var t=s(1527),r=s(3964),l=s(1917),i=s(2219);s(1673),s(1488);var a=s(6736),o=s(2651),c=s.n(o),d={src:"/_next/static/media/fedora-nginx-start-page.9e4b7ec4.png",height:1502,width:2376,blurDataURL:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAFCAMAAABPT11nAAAAM1BMVEVJesG2xNw7iqYzhaBMg7pFfbezwda2xt49crNYmrA8kLtToMdAe7hdps1Jfss7erpIodBv0BY6AAAADnRSTlP+0Jxd+vd8w6GSo/v7/roH4u4AAAAJcEhZcwAAFiUAABYlAUlSJPAAAAAuSURBVHicBcEJFgAQCEDBn2jhRfc/rRlM3N3FiAtwg3hrzvWC3VV1eqMjM3PoBxgPASsTj0QgAAAAAElFTkSuQmCC",blurWidth:8,blurHeight:5},x={src:"/_next/static/media/openwrt-port-forwarding.6e593214.png",height:558,width:929,blurDataURL:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAFCAMAAABPT11nAAAAFVBMVEX+/v7w7+/19fXV1dXh4eLq6+i0vrfhFlPdAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAJklEQVR4nCXIQQ4AIBCDQOhW//9ko5LMBaZVLYkAYlYIXnlnfvsABfMASBVVDDkAAAAASUVORK5CYII=",blurWidth:8,blurHeight:5},h={src:"/_next/static/media/cloudflare-dns-config.0aab4534.png",height:663,width:1281,blurDataURL:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAECAMAAACEE47CAAAABlBMVEX6+/vx8vRXsd+HAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAEUlEQVR4nGNgZGSAAkwGlAsAAJMABj7DBdYAAAAASUVORK5CYII=",blurWidth:8,blurHeight:4};function p(e){let n=Object.assign({p:"p",pre:"pre",code:"code",span:"span",ol:"ol",li:"li",h2:"h2",ul:"ul",a:"a",h3:"h3"},(0,a.ah)(),e.components);return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.p,{children:"리버스 프록시란 다른 서버의 앞단에 놓이는 프록시 서버로, 클라이언트의 요청을\n먼저 받아 여러 처리를 한 후에 필요한 서버에게 보내주는 역할을 한다."}),"\n",(0,t.jsx)(n.pre,{"data-language":"mermaid","data-theme":"default",children:(0,t.jsxs)(n.code,{"data-language":"mermaid","data-theme":"default",children:[(0,t.jsx)(n.span,{className:"line",children:(0,t.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:"sequenceDiagram"})}),"\n",(0,t.jsxs)(n.span,{className:"line",children:[(0,t.jsx)(n.span,{style:{color:"var(--shiki-color-text)"},children:"  "}),(0,t.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:"participant"}),(0,t.jsx)(n.span,{style:{color:"var(--shiki-color-text)"},children:" Client"})]}),"\n",(0,t.jsxs)(n.span,{className:"line",children:[(0,t.jsx)(n.span,{style:{color:"var(--shiki-color-text)"},children:"  "}),(0,t.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:"participant"}),(0,t.jsx)(n.span,{style:{color:"var(--shiki-color-text)"},children:" ReverseProxy"})]}),"\n",(0,t.jsxs)(n.span,{className:"line",children:[(0,t.jsx)(n.span,{style:{color:"var(--shiki-color-text)"},children:"  "}),(0,t.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:"participant"}),(0,t.jsx)(n.span,{style:{color:"var(--shiki-color-text)"},children:" Server"})]}),"\n",(0,t.jsxs)(n.span,{className:"line",children:[(0,t.jsx)(n.span,{style:{color:"var(--shiki-color-text)"},children:"  Client"}),(0,t.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:"->>"}),(0,t.jsx)(n.span,{style:{color:"var(--shiki-color-text)"},children:"ReverseProxy"}),(0,t.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:":"}),(0,t.jsx)(n.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,t.jsx)(n.span,{style:{color:"var(--shiki-token-string)"},children:"HTTP Request"})]}),"\n",(0,t.jsxs)(n.span,{className:"line",children:[(0,t.jsx)(n.span,{style:{color:"var(--shiki-color-text)"},children:"  ReverseProxy"}),(0,t.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:"->>"}),(0,t.jsx)(n.span,{style:{color:"var(--shiki-color-text)"},children:"Server"}),(0,t.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:":"}),(0,t.jsx)(n.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,t.jsx)(n.span,{style:{color:"var(--shiki-token-string)"},children:"HTTP Request"})]}),"\n",(0,t.jsxs)(n.span,{className:"line",children:[(0,t.jsx)(n.span,{style:{color:"var(--shiki-color-text)"},children:"  Server"}),(0,t.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:"-->>"}),(0,t.jsx)(n.span,{style:{color:"var(--shiki-color-text)"},children:"ReverseProxy"}),(0,t.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:":"}),(0,t.jsx)(n.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,t.jsx)(n.span,{style:{color:"var(--shiki-token-string)"},children:"HTTP Response"})]}),"\n",(0,t.jsxs)(n.span,{className:"line",children:[(0,t.jsx)(n.span,{style:{color:"var(--shiki-color-text)"},children:"  ReverseProxy"}),(0,t.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:"-->>"}),(0,t.jsx)(n.span,{style:{color:"var(--shiki-color-text)"},children:"Client"}),(0,t.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:":"}),(0,t.jsx)(n.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,t.jsx)(n.span,{style:{color:"var(--shiki-token-string)"},children:"HTTP Response"})]})]})}),"\n",(0,t.jsx)(n.p,{children:"홈 서버에서 운영하는 서비스를 웹으로 노출시키려고 한다.\n이때 리버스 프록시를 운영하면 아래와 같은 이점이 있다."}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsx)(n.li,{children:"보안. SSL 같은 암호화를 맡아서 처리를 할 수 있다.\n또한 내부 주소를 숨기고 도메인 주소만 노출할 수 있다."}),"\n",(0,t.jsx)(n.li,{children:"확장. 서브 도메인을 이용하여 여러 서비스를 하나의 도메인으로 노출할 수 있다."}),"\n",(0,t.jsx)(n.li,{children:"성능. 캐싱, 압축을 적용하여 성능에서 이득을 볼 수 있긴 한데... 얼마나\n이득일지는 잘 모르겠다."}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"외부에서-홈-서버에-접속하기",children:"외부에서 홈 서버에 접속하기"}),"\n",(0,t.jsx)(n.p,{children:"외부에서 내 홈서버에 접속하여 서비스를 이용하는 시나리오를 그려보자."}),"\n",(0,t.jsx)(n.p,{children:"먼저 홈 네트워크의 구성은 아래와 같다:"}),"\n",(0,t.jsx)(n.pre,{"data-language":"text","data-theme":"default",children:(0,t.jsxs)(n.code,{"data-language":"text","data-theme":"default",children:[(0,t.jsx)(n.span,{className:"line",children:(0,t.jsx)(n.span,{style:{color:"var(--shiki-color-text)"},children:"                ┌─Proxmox VE──┐"})}),"\n",(0,t.jsx)(n.span,{className:"line",children:(0,t.jsx)(n.span,{style:{color:"var(--shiki-color-text)"},children:"┌───┐  ┌──────┐ │   ┌─────┐   │"})}),"\n",(0,t.jsx)(n.span,{className:"line",children:(0,t.jsx)(n.span,{style:{color:"var(--shiki-color-text)"},children:"│WAN├─►│router├─┼──►│nginx│   │"})}),"\n",(0,t.jsx)(n.span,{className:"line",children:(0,t.jsx)(n.span,{style:{color:"var(--shiki-color-text)"},children:"└───┘  └──────┘ │   └──┬──┘   │"})}),"\n",(0,t.jsx)(n.span,{className:"line",children:(0,t.jsx)(n.span,{style:{color:"var(--shiki-color-text)"},children:"                │      ▼      │"})}),"\n",(0,t.jsx)(n.span,{className:"line",children:(0,t.jsx)(n.span,{style:{color:"var(--shiki-color-text)"},children:"                │  NextCloud  │"})}),"\n",(0,t.jsx)(n.span,{className:"line",children:(0,t.jsx)(n.span,{style:{color:"var(--shiki-color-text)"},children:"                └─────────────┘"})})]})}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsx)(n.li,{children:"웹 브라우저에 도메인을 입력한다"}),"\n",(0,t.jsx)(n.li,{children:"이 도메인을 DNS 서버에 질의하여 IP 주소를 확인한다."}),"\n",(0,t.jsx)(n.li,{children:"확인한 IP 주소로 HTTPS 요청을 보낸다."}),"\n",(0,t.jsx)(n.li,{children:"라우터는 받은 모든 HTTPS 요청을 Proxmox VE의 nginx에 넘긴다."}),"\n",(0,t.jsx)(n.li,{children:"nginx는 받은 요청을 검사하여 처리 후 적절한 서비스로 넘겨준다."}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"따라서"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"도메인을 DNS에 등록해야하고"}),"\n",(0,t.jsx)(n.li,{children:"라우터에서 nginx로 포트 포워딩 해줘야하고"}),"\n",(0,t.jsx)(n.li,{children:"nginx에서는 서브도메인을 확인하여 원하는 서비스로 넘겨줘야 한다."}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"먼저 nginx부터 설정하자."}),"\n",(0,t.jsx)(n.h2,{id:"proxmox-ve에-nginx-올리기",children:"Proxmox VE에 nginx 올리기"}),"\n",(0,t.jsx)(n.p,{children:"리버스 프록시 역할을 수행할 수 있는 소프트웨어는 아파치 HTTP 서버, HAProxy 등\n다양하다."}),"\n",(0,t.jsx)(n.p,{children:"그 중 nginx는 설정이 간편하고 기능이 많으며 성능이 좋아 사용하기 편리하다."}),"\n",(0,t.jsx)(n.p,{children:"Proxmox VE에 무언가를 올릴 때 LXC 혹은 VM으로 올릴 수 있는데, 간편하게 LXC로\n설정하였다. 사양은 최소로 잡아놓고, 필요하면 올리는 것으로."}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"템플릿: fedora37-default_20221119_arm"}),"\n",(0,t.jsx)(n.li,{children:"메모리: 512MB"}),"\n",(0,t.jsx)(n.li,{children:"코어: 1"}),"\n",(0,t.jsx)(n.li,{children:"디스크: 8GB"}),"\n",(0,t.jsx)(n.li,{children:"네트워크: DHCP"}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:["페도라에서 nginx는 ",(0,t.jsx)(n.code,{children:"dnf"}),"로 간편하게 설치할 수 있다. 서비스 관리는 ",(0,t.jsx)(n.code,{children:"systemd"}),"로\n한다."]}),"\n",(0,t.jsx)(n.pre,{"data-language":"text","data-theme":"default",children:(0,t.jsxs)(n.code,{"data-language":"text","data-theme":"default",children:[(0,t.jsx)(n.span,{className:"line",children:(0,t.jsx)(n.span,{style:{color:"var(--shiki-color-text)"},children:"$ dnf install nginx"})}),"\n",(0,t.jsx)(n.span,{className:"line",children:(0,t.jsx)(n.span,{style:{color:"var(--shiki-color-text)"},children:"$ systemctl enable nginx"})}),"\n",(0,t.jsx)(n.span,{className:"line",children:(0,t.jsx)(n.span,{style:{color:"var(--shiki-color-text)"},children:"$ systemctl start nginx"})})]})}),"\n",(0,t.jsxs)(n.p,{children:["nginx 가동 후 ",(0,t.jsx)(n.code,{children:"ip addr"}),"로 내부 주소를 확인하고 접속하면 환영 페이지를 볼 수\n있다."]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(c(),{placeholder:"blur",src:d})}),"\n",(0,t.jsx)(n.h2,{id:"openwrt에서-포트포워딩-하기",children:"OpenWRT에서 포트포워딩 하기"}),"\n",(0,t.jsx)(n.p,{children:"이제 외부에서 보낸 HTTP/HTTPS 요청을 nginx가 받을 수 있도록 라우터를\n설정해주어야 한다. 구체적으로는 라우터가 외부에서 받는 요청을 홈 네트워크의\n특정 포인트로 넘겨주도록 포트 포워딩 해주어야 한다."}),"\n",(0,t.jsx)(n.p,{children:"OpenWrt를 쓰는 경우, 온전한 리눅스이므로 nginx를 라우터에 직접 설치하여 쓸 수도\n있다. 추후에 설정을 자주 바꿀 필요가 없어지면 nginx로 옮기는 것도 좋겠다."}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://svrforum.com/svr/285089",children:"iptime 공유기에 NGINX를 돌려봅시다."})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://www.clien.net/service/board/use/17758656",children:"링크시스 공유기에 NGINX 올려서 Reverse Proxy로 쓰기"})}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"라우터로 OpenWrt를 쓰고 있는데 OpenWrt는 Network → Port Fowarding에서\n포트 포워딩 설정을 할 수 있다."}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(c(),{placeholder:"blur",src:x})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"이름: 편한 대로 설정"}),"\n",(0,t.jsx)(n.li,{children:"프로토콜: TCP. HTTP3를 고려한다면 UDP도 해야한다."}),"\n",(0,t.jsxs)(n.li,{children:["소스: 외부에서 입력을 받을 것이기에 ",(0,t.jsx)(n.code,{children:"wan"})," 선택"]}),"\n",(0,t.jsx)(n.li,{children:"외부 포트: HTTP 포트인 80, HTTPS 포트인 443을 열어준다."}),"\n",(0,t.jsx)(n.li,{children:"목적지: 내부 네트워크를 고르면 된다."}),"\n",(0,t.jsx)(n.li,{children:"내부IP: nginx를 설치한 서버의 IP"}),"\n",(0,t.jsx)(n.li,{children:"내부 포트: 굳이 바꿀 필요 없이 80, 443을 쓰자"}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"포트를 한 번에 하나만 입력할 수 있으므로 두 개를 만들어야 한다."}),"\n",(0,t.jsx)(n.p,{children:"이렇게 바꾼 후 외부 IP를 확인하여 접속하면 내부에서 접속했을 때와 동일한\n화면을 볼 수 있다."}),"\n",(0,t.jsx)(n.h2,{id:"cloudflare에-dns-등록",children:"cloudflare에 DNS 등록"}),"\n",(0,t.jsxs)(n.p,{children:["이제 도메인 주소와 IP를 연결하면 일반적인 웹 주소로 내 홈 서비스에 접속할 수 있다.\nDNS 등록은 DNS 제공 서비스를 통해 해야하는데, 본래 쓰던 ",(0,t.jsx)(n.a,{href:"https://www.cloudflare.com/",children:"cloudflare"}),"를\n이용하였다."]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"타입: A"}),"\n",(0,t.jsx)(n.li,{children:"이름: www, @, *"}),"\n",(0,t.jsx)(n.li,{children:"주소: 내 IP주소"}),"\n",(0,t.jsx)(n.li,{children:"proxy: DNS only"}),"\n",(0,t.jsx)(n.li,{children:"TTL: auto"}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(c(),{placeholder:"blur",src:h})}),"\n",(0,t.jsxs)(n.p,{children:["www와 루트(@), 와일드카드(*) 세 개를 등록하자. 완료하면 이제 ",(0,t.jsx)(n.a,{href:"http://nyeong.me",children:"nyeong.me"}),"로\n접속하면 IP주소로 접속했을 때와 동일한 화면을 볼 수 있다."]}),"\n",(0,t.jsx)(n.h3,{id:"레코드-종류",children:"레코드 종류"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"A 레코드"}),"\n",(0,t.jsx)(n.li,{children:"CNAME 레코드"}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"lets-encrypt로-인증서-받기",children:"Let's Encrypt로 인증서 받기"}),"\n",(0,t.jsxs)(n.p,{children:["지금은 http 프로토콜을 이용한 접속만 가능하다. https를 쓰려면 인증기관(CA)에서\nSSL 인증서를 발급받아야한다. 여러 CA가 있는데 그중\n",(0,t.jsx)(n.a,{href:"https://letsencrypt.org/",children:"Let's Encrypt"}),"는 무료로 인증서를 발급해준다."]}),"\n",(0,t.jsxs)(n.p,{children:["Let's Encrypt에 사이트를 인증하려면 ACME 프로토콜을 이용해야한다. 이를 지원하는\n",(0,t.jsx)(n.a,{href:"https://letsencrypt.org/docs/client-options/",children:"여러 클라이언트"}),"가 있는데"]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.a,{href:"https://dash.cloudflare.com/profile/api-tokens",children:"Cloudflare API 토큰"}),"을\n발급받는다."]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"권한: DNS에 대한 편집 권한"}),"\n",(0,t.jsx)(n.li,{children:"리소스: DNS에 등록한 도메인 주소"}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"완료하면 API 토큰을 발급해준다. 이 토큰을 이용하여 SSL 인증서를 발급받을 것이다."}),"\n",(0,t.jsx)(n.pre,{"data-language":"text","data-theme":"default",children:(0,t.jsxs)(n.code,{"data-language":"text","data-theme":"default",children:[(0,t.jsx)(n.span,{className:"line",children:(0,t.jsx)(n.span,{style:{color:"var(--shiki-color-text)"},children:"$ dnf install git openssl"})}),"\n",(0,t.jsx)(n.span,{className:"line",children:(0,t.jsx)(n.span,{style:{color:"var(--shiki-color-text)"},children:"$ git clone https://github.com/acmesh-official/acme.sh.git"})}),"\n",(0,t.jsx)(n.span,{className:"line",children:(0,t.jsx)(n.span,{style:{color:"var(--shiki-color-text)"},children:"$ cd ./acme.sh"})}),"\n",(0,t.jsx)(n.span,{className:"line",children:(0,t.jsx)(n.span,{style:{color:"var(--shiki-color-text)"},children:"$ mkdir /etc/nginx/ssl/"})}),"\n",(0,t.jsx)(n.span,{className:"line",children:(0,t.jsx)(n.span,{style:{color:"var(--shiki-color-text)"},children:"$ ./acme.sh --install --force -m me@annyeong.me"})}),"\n",(0,t.jsx)(n.span,{className:"line",children:(0,t.jsx)(n.span,{style:{color:"var(--shiki-color-text)"},children:'$ export CF_Token="위에서 발급받은 토큰"'})}),"\n",(0,t.jsx)(n.span,{className:"line",children:(0,t.jsx)(n.span,{style:{color:"var(--shiki-color-text)"},children:'$ export CF_Email="cloudflare 이메일"'})}),"\n",(0,t.jsx)(n.span,{className:"line",children:(0,t.jsx)(n.span,{style:{color:"var(--shiki-color-text)"},children:"$ acme.sh --issue \\"})}),"\n",(0,t.jsx)(n.span,{className:"line",children:(0,t.jsx)(n.span,{style:{color:"var(--shiki-color-text)"},children:"          --dns dns_cf \\"})}),"\n",(0,t.jsx)(n.span,{className:"line",children:(0,t.jsx)(n.span,{style:{color:"var(--shiki-color-text)"},children:"          --server letsencrypt \\"})}),"\n",(0,t.jsx)(n.span,{className:"line",children:(0,t.jsx)(n.span,{style:{color:"var(--shiki-color-text)"},children:"          -d nyeong.me -d '*.nyeong.me' \\"})}),"\n",(0,t.jsx)(n.span,{className:"line",children:(0,t.jsx)(n.span,{style:{color:"var(--shiki-color-text)"},children:"          --keylength ec-256 \\"})}),"\n",(0,t.jsx)(n.span,{className:"line",children:(0,t.jsx)(n.span,{style:{color:"var(--shiki-color-text)"},children:"          --key-file /etc/nginx/ssl/privkey.pem \\"})}),"\n",(0,t.jsx)(n.span,{className:"line",children:(0,t.jsx)(n.span,{style:{color:"var(--shiki-color-text)"},children:"          --fullchain-file /etc/nginx/ssl/fullchain.pem \\"})}),"\n",(0,t.jsx)(n.span,{className:"line",children:(0,t.jsx)(n.span,{style:{color:"var(--shiki-color-text)"},children:"          --cert-file /etc/nginx/ssl/chain.pem \\"})}),"\n",(0,t.jsx)(n.span,{className:"line",children:(0,t.jsx)(n.span,{style:{color:"var(--shiki-color-text)"},children:'          --reloadcmd "systemctl reload nginx.service"'})})]})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["acme.sh는 install 할 때 cron이 존재하는지 검사한다. 페도라는 ",(0,t.jsx)(n.code,{children:"systemd"}),"를\n이용하므로 cron이 없으므로 ",(0,t.jsx)(n.code,{children:"--force"})," 명령어로 진행시킨다.\n",(0,t.jsx)(n.code,{children:"acme.sh --cron"})]}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:["이후 ",(0,t.jsx)(n.code,{children:"acme.sh list"})," 확인하면 잘 발급되었음을 볼 수 있다."]}),"\n",(0,t.jsx)(n.pre,{"data-language":"text","data-theme":"default",children:(0,t.jsxs)(n.code,{"data-language":"text","data-theme":"default",children:[(0,t.jsx)(n.span,{className:"line",children:(0,t.jsx)(n.span,{style:{color:"var(--shiki-color-text)"},children:"$ acme.sh list"})}),"\n",(0,t.jsx)(n.span,{className:"line",children:(0,t.jsx)(n.span,{style:{color:"var(--shiki-color-text)"},children:"Main_Domain  KeyLength  SAN_Domains  CA               Created               Renew"})}),"\n",(0,t.jsx)(n.span,{className:"line",children:(0,t.jsx)(n.span,{style:{color:"var(--shiki-color-text)"},children:'nyeong.me    "ec-256"   *.nyeong.me  LetsEncrypt.org  2023-03-20T05:03:49Z  2023-05-18T05:03:49Z'})})]})}),"\n",(0,t.jsxs)(n.p,{children:["SSL 설정은 모질라의\n",(0,t.jsx)(n.a,{href:"https://ssl-config.mozilla.org/#server=nginx&version=1.22.1&config=modern&openssl=3.0.5&guideline=5.6",children:"SSL Configuration Generator"}),"를\n이용하였다."]}),"\n",(0,t.jsx)(n.pre,{"data-language":"text","data-theme":"default",children:(0,t.jsxs)(n.code,{"data-language":"text","data-theme":"default",children:[(0,t.jsx)(n.span,{className:"line",children:(0,t.jsx)(n.span,{style:{color:"var(--shiki-color-text)"},children:"server {"})}),"\n",(0,t.jsx)(n.span,{className:"line",children:(0,t.jsx)(n.span,{style:{color:"var(--shiki-color-text)"},children:"		listen       443 ssl http2;"})}),"\n",(0,t.jsx)(n.span,{className:"line",children:(0,t.jsx)(n.span,{style:{color:"var(--shiki-color-text)"},children:"		listen       [::]:443 ssl http2;"})}),"\n",(0,t.jsx)(n.span,{className:"line",children:(0,t.jsx)(n.span,{style:{color:"var(--shiki-color-text)"},children:"		server_name  _;"})}),"\n",(0,t.jsx)(n.span,{className:"line",children:(0,t.jsx)(n.span,{style:{color:"var(--shiki-color-text)"},children:"		root         /usr/share/nginx/html;"})}),"\n",(0,t.jsx)(n.span,{className:"line",children:(0,t.jsx)(n.span,{style:{color:"var(--shiki-color-text)"}})}),"\n",(0,t.jsx)(n.span,{className:"line",children:(0,t.jsx)(n.span,{style:{color:"var(--shiki-color-text)"},children:'		ssl_certificate "/etc/nginx/ssl/fullchain.pem";'})}),"\n",(0,t.jsx)(n.span,{className:"line",children:(0,t.jsx)(n.span,{style:{color:"var(--shiki-color-text)"},children:'		ssl_certificate_key "/etc/nginx/ssl/privkey.pem";'})}),"\n",(0,t.jsx)(n.span,{className:"line",children:(0,t.jsx)(n.span,{style:{color:"var(--shiki-color-text)"},children:"		ssl_trusted_certificate /etc/nginx/ssl/chain.pem;"})}),"\n",(0,t.jsx)(n.span,{className:"line",children:(0,t.jsx)(n.span,{style:{color:"var(--shiki-color-text)"},children:"		ssl_session_cache shared:MozSSL:10m;"})}),"\n",(0,t.jsx)(n.span,{className:"line",children:(0,t.jsx)(n.span,{style:{color:"var(--shiki-color-text)"},children:"		ssl_session_timeout  1d;"})}),"\n",(0,t.jsx)(n.span,{className:"line",children:(0,t.jsx)(n.span,{style:{color:"var(--shiki-color-text)"},children:"		ssl_session_tickets off;"})}),"\n",(0,t.jsx)(n.span,{className:"line",children:(0,t.jsx)(n.span,{style:{color:"var(--shiki-color-text)"}})}),"\n",(0,t.jsx)(n.span,{className:"line",children:(0,t.jsx)(n.span,{style:{color:"var(--shiki-color-text)"},children:"		ssl_protocols TLSv1.3;"})}),"\n",(0,t.jsx)(n.span,{className:"line",children:(0,t.jsx)(n.span,{style:{color:"var(--shiki-color-text)"},children:"		ssl_prefer_server_ciphers off;"})}),"\n",(0,t.jsx)(n.span,{className:"line",children:(0,t.jsx)(n.span,{style:{color:"var(--shiki-color-text)"}})}),"\n",(0,t.jsx)(n.span,{className:"line",children:(0,t.jsx)(n.span,{style:{color:"var(--shiki-color-text)"},children:'		add_header Strict-Transport-Security "max-age=63072000" always;'})}),"\n",(0,t.jsx)(n.span,{className:"line",children:(0,t.jsx)(n.span,{style:{color:"var(--shiki-color-text)"}})}),"\n",(0,t.jsx)(n.span,{className:"line",children:(0,t.jsx)(n.span,{style:{color:"var(--shiki-color-text)"},children:"		# OCSP stapling"})}),"\n",(0,t.jsx)(n.span,{className:"line",children:(0,t.jsx)(n.span,{style:{color:"var(--shiki-color-text)"},children:"		ssl_stapling on;"})}),"\n",(0,t.jsx)(n.span,{className:"line",children:(0,t.jsx)(n.span,{style:{color:"var(--shiki-color-text)"},children:"		ssl_stapling_verify on;"})}),"\n",(0,t.jsx)(n.span,{className:"line",children:(0,t.jsx)(n.span,{style:{color:"var(--shiki-color-text)"}})}),"\n",(0,t.jsx)(n.span,{className:"line",children:(0,t.jsx)(n.span,{style:{color:"var(--shiki-color-text)"},children:"		# verify chain of trust of OCSP response using Root CA and Intermediate certs"})}),"\n",(0,t.jsx)(n.span,{className:"line",children:(0,t.jsx)(n.span,{style:{color:"var(--shiki-color-text)"}})}),"\n",(0,t.jsx)(n.span,{className:"line",children:(0,t.jsx)(n.span,{style:{color:"var(--shiki-color-text)"},children:"		# replace with the IP address of your resolver"})}),"\n",(0,t.jsx)(n.span,{className:"line",children:(0,t.jsx)(n.span,{style:{color:"var(--shiki-color-text)"},children:"		resolver 127.0.0.1;"})}),"\n",(0,t.jsx)(n.span,{className:"line",children:(0,t.jsx)(n.span,{style:{color:"var(--shiki-color-text)"},children:"}"})})]})}),"\n",(0,t.jsx)(n.h3,{id:"리버스-프록시",children:"리버스 프록시"}),"\n",(0,t.jsx)(n.p,{children:"ㅈ"}),"\n",(0,t.jsx)(n.h3,{id:"nextcloud",children:"nextcloud"}),"\n",(0,t.jsx)(n.p,{children:"occ 실행"}),"\n",(0,t.jsx)(n.pre,{"data-language":"text","data-theme":"default",children:(0,t.jsx)(n.code,{"data-language":"text","data-theme":"default",children:(0,t.jsx)(n.span,{className:"line",children:(0,t.jsx)(n.span,{style:{color:"var(--shiki-color-text)"},children:"su www-data -s /usr/bin/php /var/www/nextcloud/occ"})})})})]})}let g={MDXContent:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{wrapper:n}=Object.assign({},(0,a.ah)(),e.components);return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(p,{...e})}):p(e)},pageOpts:{filePath:"pages/notes/nginx-reverse-proxy.md",route:"/notes/nginx-reverse-proxy",frontMatter:{title:"Nginx로 리버스 프록시",description:"Proxmox VE에 리버스 프록시 서버 세팅하기",date:"2023-03-19T00:00:00.000Z",tags:null},headings:[{depth:2,value:"외부에서 홈 서버에 접속하기",id:"외부에서-홈-서버에-접속하기"},{depth:2,value:"Proxmox VE에 nginx 올리기",id:"proxmox-ve에-nginx-올리기"},{depth:2,value:"OpenWRT에서 포트포워딩 하기",id:"openwrt에서-포트포워딩-하기"},{depth:2,value:"cloudflare에 DNS 등록",id:"cloudflare에-dns-등록"},{depth:3,value:"레코드 종류",id:"레코드-종류"},{depth:2,value:"Let's Encrypt로 인증서 받기",id:"lets-encrypt로-인증서-받기"},{depth:3,value:"리버스 프록시",id:"리버스-프록시"},{depth:3,value:"nextcloud",id:"nextcloud"}],pageMap:[{kind:"MdxPage",name:"index",route:"/",frontMatter:{title:"index",date:"2023-01-10T00:00:00.000Z",tags:[]}},{kind:"Folder",name:"notes",route:"/notes",children:[{kind:"MdxPage",name:"GTD",route:"/notes/GTD",frontMatter:{title:"GTD",description:"글 설명",date:"2023-03-31T00:00:00.000Z",tags:null}},{kind:"MdxPage",name:"algorithm",route:"/notes/algorithm",frontMatter:{title:"알고리즘",description:null,date:"2023-02-24T00:00:00.000Z",tags:null}},{kind:"MdxPage",name:"category-theory",route:"/notes/category-theory",frontMatter:{title:"카테고리 이론"}},{kind:"MdxPage",name:"composition-and-programming",route:"/notes/composition-and-programming",frontMatter:{title:"합성과 프로그래밍"}},{kind:"MdxPage",name:"concurrency",route:"/notes/concurrency",frontMatter:{title:"동시성",description:"동시성을 다루는 방법",date:"2023-02-24T00:00:00.000Z",tags:null}},{kind:"MdxPage",name:"cs-terms",route:"/notes/cs-terms",frontMatter:{title:"용어 정리"}},{kind:"MdxPage",name:"data-structures",route:"/notes/data-structures",frontMatter:{title:"자료구조",description:null,date:"2023-02-24T00:00:00.000Z",tags:null}},{kind:"MdxPage",name:"database",route:"/notes/database",frontMatter:{title:"데이터베이스",description:"데이터베이스",date:"2023-02-24T00:00:00.000Z",tags:[]}},{kind:"MdxPage",name:"design-pattern",route:"/notes/design-pattern",frontMatter:{title:"디자인 패턴",description:null,date:"2023-02-24T00:00:00.000Z",tags:null}},{kind:"MdxPage",name:"devenv",route:"/notes/devenv",frontMatter:{title:"\uD83D\uDCBB 개발환경",description:"내 개발환경 정리"}},{kind:"MdxPage",name:"dictionary",route:"/notes/dictionary",frontMatter:{title:"딕셔너리",description:null,date:"2023-02-24T00:00:00.000Z",tags:null}},{kind:"MdxPage",name:"dining-philosophers",route:"/notes/dining-philosophers",frontMatter:{title:"식사하는 철학자 문제",description:null,date:"2023-02-24T00:00:00.000Z",tags:null}},{kind:"MdxPage",name:"disjoint-set",route:"/notes/disjoint-set",frontMatter:{title:"서로소 집합",description:null,date:"2023-02-24T00:00:00.000Z",tags:null}},{kind:"MdxPage",name:"elixir",route:"/notes/elixir",frontMatter:{title:"엘릭서",description:"글 설명",date:"2023-03-14T00:00:00.000Z",tags:null}},{kind:"MdxPage",name:"exceptions",route:"/notes/exceptions",frontMatter:{title:"예외를 처리하는 방법",description:null,date:"2023-02-24T00:00:00.000Z",tags:null}},{kind:"MdxPage",name:"hanassig",route:"/notes/hanassig",frontMatter:{title:"하나씩",description:"공부한 거 정리하기"}},{kind:"MdxPage",name:"idris",route:"/notes/idris",frontMatter:{title:"idris",description:"idris 프로그래밍 언어",date:"2023-03-15T00:00:00.000Z",tags:null}},{kind:"MdxPage",name:"korean-encoding",route:"/notes/korean-encoding",frontMatter:{title:"한글 인코딩",description:"파인더에서 괜찮던 한글이 망가지는 이유",date:"2022-02-26T00:00:00.000Z",tags:null}},{kind:"MdxPage",name:"life-optimization",route:"/notes/life-optimization",frontMatter:{title:"최적화",description:"내 삶을 최적화하기",date:"2023-03-28T00:00:00.000Z",tags:null}},{kind:"MdxPage",name:"linear-list",route:"/notes/linear-list",frontMatter:{title:"선형 리스트",description:null,date:"2023-02-24T00:00:00.000Z",tags:null}},{kind:"MdxPage",name:"machine-learning",route:"/notes/machine-learning",frontMatter:{title:"\uD83E\uDD16 기계학습",description:"기계학습의 개론적인 갈래를 이해하기 위한 문서",date:"2023-02-24T00:00:00.000Z",tags:[]}},{kind:"MdxPage",name:"macos",route:"/notes/macos",frontMatter:{title:"macOS",date:"2023-02-21T00:00:00.000Z"}},{kind:"MdxPage",name:"mathematical-induction",route:"/notes/mathematical-induction",frontMatter:{title:"수학적 귀납법",description:"글 설명",date:"2023-03-30T00:00:00.000Z",tags:null}},{kind:"MdxPage",name:"minimum-spanning-tree",route:"/notes/minimum-spanning-tree",frontMatter:{title:"최소 신장 트리",description:null,date:"2022-08-19T00:00:00.000Z",tags:null}},{kind:"MdxPage",name:"miryoku",route:"/notes/miryoku",frontMatter:{title:"miryoku",description:null,date:"2023-02-24T00:00:00.000Z",tags:null}},{kind:"MdxPage",name:"monad-functor-applicative",route:"/notes/monad-functor-applicative",frontMatter:{title:"모나드와 펑터와 어플리케이티브",description:"함수형 삼대장을 아는 척 해보자",date:"2023-03-08T00:00:00.000Z",tags:null}},{kind:"MdxPage",name:"music",route:"/notes/music",frontMatter:{title:"\uD83C\uDFBC 음악"}},{kind:"MdxPage",name:"my-new-gears",route:"/notes/my-new-gears",frontMatter:{title:"My New Gears",tags:"my-new-gears",date:"2023-02-21T00:00:00.000Z"}},{kind:"MdxPage",name:"network",route:"/notes/network",frontMatter:{title:"네트워크",description:"컴퓨터 네트워크",date:"2023-03-22T00:00:00.000Z",tags:null}},{kind:"MdxPage",name:"nginx-reverse-proxy",route:"/notes/nginx-reverse-proxy",frontMatter:{title:"Nginx로 리버스 프록시",description:"Proxmox VE에 리버스 프록시 서버 세팅하기",date:"2023-03-19T00:00:00.000Z",tags:null}},{kind:"MdxPage",name:"nth-week-today",route:"/notes/nth-week-today",frontMatter:{title:"오늘은 몇 주차",tags:["DIY"]}},{kind:"MdxPage",name:"openwrt",route:"/notes/openwrt",frontMatter:{title:"OpenWrt",description:"OpenWrt로 라우터 써먹기",date:"2023-03-02T00:00:00.000Z",tags:null}},{kind:"MdxPage",name:"order",route:"/notes/order",frontMatter:{title:"순서",description:"전순서와 부분순서",date:"2023-03-17T00:00:00.000Z",tags:null}},{kind:"MdxPage",name:"os",route:"/notes/os",frontMatter:{title:"운영체제",description:null,date:"2023-02-24T00:00:00.000Z",tags:null}},{kind:"MdxPage",name:"phoenix",route:"/notes/phoenix",frontMatter:{title:"Phoenix",description:"phoenix 웹 프레임워크",date:"2023-02-23T00:00:00.000Z",tags:null}},{kind:"MdxPage",name:"postgresql",route:"/notes/postgresql",frontMatter:{title:"PostgreSQL",description:"PostgreSQL 기본적인 사용법 정리",date:"2023-03-04T00:00:00.000Z",tags:null}},{kind:"MdxPage",name:"programming-languages",route:"/notes/programming-languages",frontMatter:{title:"프로그래밍 언어"}},{kind:"MdxPage",name:"proxmox-setup",route:"/notes/proxmox-setup",frontMatter:{title:"Proxmox VE 기초설정",description:"Proxmox VE 설치 후 해야하는 기초 설정",date:"2023-03-18T00:00:00.000Z",tags:null}},{kind:"MdxPage",name:"proxmox-storage",route:"/notes/proxmox-storage",frontMatter:{title:"Proxmox 저장장치 설정",description:"Proxmox VE에 저장장치를 설정하기",date:"2023-03-18T00:00:00.000Z",tags:null}},{kind:"MdxPage",name:"scala",route:"/notes/scala",frontMatter:{title:"스칼라",description:"스칼라 프로그래밍 언어",date:"2023-03-10T00:00:00.000Z",tags:null}},{kind:"MdxPage",name:"sql",route:"/notes/sql",frontMatter:{title:"SQL",description:"SQL 기초 사용법",date:"2023-03-09T00:00:00.000Z",tags:null}},{kind:"MdxPage",name:"types-are-sets",route:"/notes/types-are-sets",frontMatter:{title:"타입은 집합이다"}},{kind:"MdxPage",name:"uibox",route:"/notes/uibox",frontMatter:{title:"UiBox",description:"개인용 서버",date:"2023-02-24T00:00:00.000Z",tags:null}},{kind:"MdxPage",name:"unix-signal",route:"/notes/unix-signal",frontMatter:{title:"유닉스 신호",description:null,date:"2023-02-24T00:00:00.000Z",tags:null}},{kind:"MdxPage",name:"web-backend",route:"/notes/web-backend",frontMatter:{title:"\uD83C\uDF0D 웹 백엔드",description:"웹 백엔드에 대해 알아야 할 것들",date:"2023-02-23T00:00:00.000Z",tags:null}},{kind:"MdxPage",name:"zsh",route:"/notes/zsh",frontMatter:{title:"zsh"}},{kind:"Meta",data:{GTD:"GTD","mathematical-induction":"수학적 귀납법","life-optimization":"최적화",network:"네트워크","nginx-reverse-proxy":"Nginx로 리버스 프록시","proxmox-setup":"Proxmox VE 기초설정","proxmox-storage":"Proxmox 저장장치 설정",order:"순서",idris:"idris",elixir:"엘릭서",scala:"스칼라",sql:"SQL","monad-functor-applicative":"모나드와 펑터와 어플리케이티브",postgresql:"PostgreSQL",openwrt:"OpenWrt",algorithm:"알고리즘",concurrency:"동시성","data-structures":"자료구조",database:"데이터베이스","design-pattern":"디자인 패턴",dictionary:"딕셔너리","dining-philosophers":"식사하는 철학자 문제","disjoint-set":"서로소 집합",exceptions:"예외를 처리하는 방법","linear-list":"선형 리스트","machine-learning":"\uD83E\uDD16 기계학습",miryoku:"miryoku",os:"운영체제",uibox:"UiBox","unix-signal":"유닉스 신호",phoenix:"Phoenix","web-backend":"\uD83C\uDF0D 웹 백엔드",macos:"macOS","my-new-gears":"My New Gears","minimum-spanning-tree":"최소 신장 트리","korean-encoding":"한글 인코딩",music:"\uD83C\uDFBC 음악",devenv:"\uD83D\uDCBB 개발환경",zsh:"zsh","nth-week-today":"오늘은 몇 주차","cs-terms":"용어 정리","category-theory":"카테고리 이론","types-are-sets":"타입은 집합이다","programming-languages":"프로그래밍 언어",hanassig:"하나씩","composition-and-programming":"합성과 프로그래밍"}}]},{kind:"Meta",data:{index:"index"}}],flexsearch:{codeblocks:!0},title:"Nginx로 리버스 프록시"},pageNextRoute:"/notes/nginx-reverse-proxy",nextraLayout:l.ZP,themeConfig:i.Z};var j=(0,r.j)(g)}},function(e){e.O(0,[9774,2131,2888,179],function(){return e(e.s=2653)}),_N_E=e.O()}]);