<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><meta name="next-head-count" content="2"/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/_next/static/chunks/webpack-8fa1640cc84ba8fe.js" defer=""></script><script src="/_next/static/chunks/framework-2c79e2a64abdb08b.js" defer=""></script><script src="/_next/static/chunks/main-4dcb7f9b52833aba.js" defer=""></script><script src="/_next/static/chunks/pages/_app-aea6920bd27938ca.js" defer=""></script><script src="/_next/static/chunks/664-8af8765c6fed5950.js" defer=""></script><script src="/_next/static/chunks/pages/n/%5B%5B...slug%5D%5D-bdd4a78633ed557a.js" defer=""></script><script src="/_next/static/GlTOjBOhO6xWONgruXGi2/_buildManifest.js" defer=""></script><script src="/_next/static/GlTOjBOhO6xWONgruXGi2/_ssgManifest.js" defer=""></script></head><body><div id="__next"><nav><div><a href="/">하나씩</a></div><div><a href="/n">index</a><a href="/tags">주제별</a></div></nav><div><main><article><header><h1>OpenWrt</h1></header><h2>Wireguard를 이용한 VPN 설정</h2>
<p>VPN은 공개 네트워크에서 비밀 네트워크로 접속할 때 유용한 보안 기술이다. 이를 이용하면 외부에서도 홈 네트워크에 안전하고 편리하게 접속할 수 있다.</p>
<p>다양한 프로토콜이 있는데, 최근 리눅스 커널(5.6)에 포함된 wireguard가 편리하다.</p>
<p>OpenWRT를 VPN 서버로 이용할 수 있다.</p>
<p><a href="https://openwrt.org/docs/guide-user/services/vpn/wireguard/basics">WireGuard basics</a></p>
<h3>설치</h3>
<p>wireguard 프로토콜 자체는 커널에 포함되었으나, 관리도구는 별도로 설치해야한다. LuCI에서 편히 쓰고자 설치하는 거라서 없어도 무방하긴 하다. SSH로 접속하여 다음을 진행한다:</p>
<pre><code>opkg update
opkg install luci-proto-wireguard luci-app-wireguard
/etc/init.d/network restart
</code></pre>
<p>혹은 LuCI → System → Software에 접속하여 두 패키지를 찾아 설치한다. 그 후 LuCI → System → Startup → Initscripts → network에서 restart를 누른다.</p>
<h3>키쌍 생성하기</h3>
<p>wireguard는 공개키 암호화 방식을 이용한다. 다음 명령어로 공개키 쌍을 생성하자:</p>
<pre><code>mkdir /etc/wireguard
cd /etc/wireguard
wg genkey | tee uibook | wg pubkey &gt; uibook.pub
chmod 600 uibook
</code></pre>
<p><code>/etc/wireguard</code>는 키 저장을 위하여 임의로 만든 공간이다. <code>wg genkey</code> 명령어로 비밀키를, <code>wg pubkey</code> 명령어로 공개키를 만든다. 그중 비밀키는 반드시 권한을 <code>600</code>으로 수정하자.</p>
<h3>인터페이스 생성하기</h3>
<p>새로운 프로토콜(wireguard)를 사용하기 때문에, 통신을 위해서 새로운 인터페이스를 정의해야한다. LuCI → Network → Interfaces에서 할 수 있다.</p>
<ul>
<li>이름: wg0. 그냥 이걸 제일 많이 쓰더라.</li>
<li>protocol: WireGuard VPN</li>
<li>private key: 아까 생성한 비밀키</li>
<li>public key: 아까 생성한 공개키</li>
<li>listen port: 49152 ~ 65535에서 고르면 된다는데 그냥 두면 랜덤 되는 듯</li>
<li>ip addresses: 해당 인터페이스에 할당할 IP이다. 10.9.0.1/24로 했다. 이 IP가 게이트웨이 역할을 한다.</li>
</ul>
<p><code>/etc/config/network</code> 파일을 편집하여서 할 수도 있다. 아래처럼 추가하면 된다.</p>
<pre><code>config interface &#x27;wg0&#x27;
        option proto &#x27;wireguard&#x27;
        option private_key &#x27;[비밀키 내용 입력]&#x27;
        list addresses &#x27;10.9.0.1/24&#x27;
</code></pre>
<h3>피어 설정하기</h3>
<p>같은 곳에서 피어 설정도 같이 진행해야 한다. 피어란 접속하고자 하는 기기이다. 아래의 앱을 이용하면 편리하게 접속할 수 있다.</p>
<p><a href="https://www.wireguard.com/install/">Installation - WireGuard</a></p>
<p>접속자도 공개키/비밀키 쌍을 만들고 공개키를 wireguard 서버에 등록해야한다. 그러나 서버에서 공개키/비밀키를 생성하고 이 자체를 공유해버릴 수도 있다.</p>
<p>따라서 LuCI에서 <code>Generate new key pair</code>로 키쌍을 만들어버리고, 설정을 완료한 후 해당 설정을 QR 코드나 conf 파일 형태로 접속을 원하는 피어에 공유하여 등록하면 편하게 피어를 설정할 수 있다. QR코드로 보기 위해서는 qrencode 패키지를 설치해야한다.</p>
<ul>
<li>Public Key: 접속하고자 하는 장치의 공개키</li>
<li>Private Key: 접속하고자 하는 장치의 비밀키. 접속에는 필요 없지만 이를 넣으면 설정파일 공유할 때 편해진다.</li>
<li>Preshared Key: 사실 뭔지 모르겠다.</li>
<li>Allowed IPs: 피어가 터널 안에서 쓰도록 허용한 IP 대역.</li>
<li>Persistent Keep Alive: 25가 권장값인듯</li>
</ul>
<pre><code>config wireguard_wg0
        option public_key &#x27;cIDLafiUna6OyxWd4aCtmTpGt1XIaCGVzmfEuEC4nmQ=&#x27;
        option private_key &#x27;[검열 삭제]&#x27;
        option preshared_key &#x27;[검열 삭제]&#x27;
        list allowed_ips &#x27;10.9.0.0/24&#x27;
        option persistent_keepalive &#x27;25&#x27;
</code></pre>
<p>설정 후 가장 밑의 <code>Generate configuration...</code>을 누르면 설정을 피어에게 내보낼 수 있다. 이를 복사하거나 QR코드로 촬영하여 등록한다.</p>
<pre><code>[Interface]
PrivateKey = 이 클라이언트의 개인키
Address = 할당 받을 IP (예: 10.9.0.3/24)
DNS = 라우터 DNS (192.168.1.1)

[Peer]
PublicKey = 서버의 공개키
AllowedIPs = 0.0.0.0/0
Endpoint = 서버주소:포트
</code></pre>
<p>여기서 <code>AllowedIPs</code>는 VPN을 거칠 IP를 의미한다. <code>0.0.0.0/0</code>으로 되어있다면
모든 접속을 VPN을 거쳐서 하게 된다.</p>
<h3>방화벽 설정</h3>
<p>이제 방화벽을 개방해주어야한다. LuCI → Network → Firewall에서 설정 할 수 있다. 이 작업은 <code>/etc/config/firewall</code>을 수정하여서 할 수도 있다.</p>
<p>General Settings 하단의 Zones에서 Add를 눌러 존을 만든다.</p>
<ul>
<li>Name: 원하는 이름으로 한다. 여기서는 <code>wireguard</code>로 하였다.</li>
<li>Input/Output: Accept</li>
<li>Forward: Reject</li>
<li>Masquerading: 체크하라는데 뭔지는 모르겠다.</li>
<li>MSS clamping: 체크하라는데 뭔지는 모르겠다.</li>
<li>Covered Networks: 아까 만든 <code>wg0</code></li>
<li>Allow forward to destination zones: 이 존에서 어떤 존으로 갈 수 있는 지를 묻는 것이다. VPN으로 접속시 내부 네트워크와 외부망을 모두 쓰고 싶으므로 <code>lan</code>, <code>wan</code>을 고른다</li>
<li>Allow forward to source zones: 외부망에서는 접근을 원치 않으므로 <code>lan</code>만 고른다.</li>
</ul>
<pre><code>config zone
        option name &#x27;wireguard&#x27;
        option input &#x27;ACCEPT&#x27;
        option output &#x27;ACCEPT&#x27;
        option forward &#x27;REJECT&#x27;
        option masq &#x27;1&#x27;
        option mtu_fix &#x27;1&#x27;
        list network &#x27;wg0&#x27;

config forwarding
        option src &#x27;wireguard&#x27;
        option dest &#x27;lan&#x27;

config forwarding
        option src &#x27;wireguard&#x27;
        option dest &#x27;wan&#x27;

config forwarding
        option src &#x27;lan&#x27;
        option dest &#x27;wireguard&#x27;
</code></pre>
<p>이제 포트를 개방해줄 차례이다.</p>
<p>Traffic Rules 탭에 들어가 Add를 누른다.</p>
<ul>
<li>Name: 작명 규칙에 맞게 <code>Allow-Wireguard</code>로 하자.</li>
<li>Protocol: wireguard는 UDP를 사용하므로 UDP만 체크한다</li>
<li>Source zone: 외부에서의 접속이므로 <code>wan</code>에 체크한다.</li>
<li>Destination port: 기본 wireguard 포트인 51820을 쓴다.</li>
<li>Action: 당연히 accept</li>
</ul></article></main></div><footer><ul><li><a href="https://github.com/nyeong/hanassig">Repo</a></li><li>안녕 ©️ <a href="https://github.com/nyeong/hanassig/blob/main/LICENSE">CC BY-SA</a></li></ul></footer></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"note":{"title":"OpenWrt","description":"OpenWrt로 라우터 써먹기","date":"2023-03-02T00:00:00.000Z","tags":null,"body":{"raw":"\n## Wireguard를 이용한 VPN 설정\n\nVPN은 공개 네트워크에서 비밀 네트워크로 접속할 때 유용한 보안 기술이다. 이를 이용하면 외부에서도 홈 네트워크에 안전하고 편리하게 접속할 수 있다.\n\n다양한 프로토콜이 있는데, 최근 리눅스 커널(5.6)에 포함된 wireguard가 편리하다.\n\nOpenWRT를 VPN 서버로 이용할 수 있다.\n\n[WireGuard basics](https://openwrt.org/docs/guide-user/services/vpn/wireguard/basics)\n\n### 설치\n\nwireguard 프로토콜 자체는 커널에 포함되었으나, 관리도구는 별도로 설치해야한다. LuCI에서 편히 쓰고자 설치하는 거라서 없어도 무방하긴 하다. SSH로 접속하여 다음을 진행한다:\n\n```\nopkg update\nopkg install luci-proto-wireguard luci-app-wireguard\n/etc/init.d/network restart\n```\n\n혹은 LuCI → System → Software에 접속하여 두 패키지를 찾아 설치한다. 그 후 LuCI → System → Startup → Initscripts → network에서 restart를 누른다.\n\n### 키쌍 생성하기\n\nwireguard는 공개키 암호화 방식을 이용한다. 다음 명령어로 공개키 쌍을 생성하자:\n\n```\nmkdir /etc/wireguard\ncd /etc/wireguard\nwg genkey | tee uibook | wg pubkey \u003e uibook.pub\nchmod 600 uibook\n```\n\n`/etc/wireguard`는 키 저장을 위하여 임의로 만든 공간이다. `wg genkey` 명령어로 비밀키를, `wg pubkey` 명령어로 공개키를 만든다. 그중 비밀키는 반드시 권한을 `600`으로 수정하자.\n\n### 인터페이스 생성하기\n\n새로운 프로토콜(wireguard)를 사용하기 때문에, 통신을 위해서 새로운 인터페이스를 정의해야한다. LuCI → Network → Interfaces에서 할 수 있다.\n\n- 이름: wg0. 그냥 이걸 제일 많이 쓰더라.\n- protocol: WireGuard VPN\n- private key: 아까 생성한 비밀키\n- public key: 아까 생성한 공개키\n- listen port: 49152 ~ 65535에서 고르면 된다는데 그냥 두면 랜덤 되는 듯\n- ip addresses: 해당 인터페이스에 할당할 IP이다. 10.9.0.1/24로 했다. 이 IP가 게이트웨이 역할을 한다.\n\n`/etc/config/network` 파일을 편집하여서 할 수도 있다. 아래처럼 추가하면 된다.\n\n```\nconfig interface 'wg0'\n        option proto 'wireguard'\n        option private_key '[비밀키 내용 입력]'\n        list addresses '10.9.0.1/24'\n```\n\n### 피어 설정하기\n\n같은 곳에서 피어 설정도 같이 진행해야 한다. 피어란 접속하고자 하는 기기이다. 아래의 앱을 이용하면 편리하게 접속할 수 있다.\n\n[Installation - WireGuard](https://www.wireguard.com/install/)\n\n접속자도 공개키/비밀키 쌍을 만들고 공개키를 wireguard 서버에 등록해야한다. 그러나 서버에서 공개키/비밀키를 생성하고 이 자체를 공유해버릴 수도 있다.\n\n따라서 LuCI에서 `Generate new key pair`로 키쌍을 만들어버리고, 설정을 완료한 후 해당 설정을 QR 코드나 conf 파일 형태로 접속을 원하는 피어에 공유하여 등록하면 편하게 피어를 설정할 수 있다. QR코드로 보기 위해서는 qrencode 패키지를 설치해야한다.\n\n- Public Key: 접속하고자 하는 장치의 공개키\n- Private Key: 접속하고자 하는 장치의 비밀키. 접속에는 필요 없지만 이를 넣으면 설정파일 공유할 때 편해진다.\n- Preshared Key: 사실 뭔지 모르겠다.\n- Allowed IPs: 피어가 터널 안에서 쓰도록 허용한 IP 대역.\n- Persistent Keep Alive: 25가 권장값인듯\n\n```\nconfig wireguard_wg0\n        option public_key 'cIDLafiUna6OyxWd4aCtmTpGt1XIaCGVzmfEuEC4nmQ='\n        option private_key '[검열 삭제]'\n        option preshared_key '[검열 삭제]'\n        list allowed_ips '10.9.0.0/24'\n        option persistent_keepalive '25'\n```\n\n설정 후 가장 밑의 `Generate configuration...`을 누르면 설정을 피어에게 내보낼 수 있다. 이를 복사하거나 QR코드로 촬영하여 등록한다.\n\n```\n[Interface]\nPrivateKey = 이 클라이언트의 개인키\nAddress = 할당 받을 IP (예: 10.9.0.3/24)\nDNS = 라우터 DNS (192.168.1.1)\n\n[Peer]\nPublicKey = 서버의 공개키\nAllowedIPs = 0.0.0.0/0\nEndpoint = 서버주소:포트\n```\n\n여기서 `AllowedIPs`는 VPN을 거칠 IP를 의미한다. `0.0.0.0/0`으로 되어있다면\n모든 접속을 VPN을 거쳐서 하게 된다.\n\n### 방화벽 설정\n\n이제 방화벽을 개방해주어야한다. LuCI → Network → Firewall에서 설정 할 수 있다. 이 작업은 `/etc/config/firewall`을 수정하여서 할 수도 있다.\n\nGeneral Settings 하단의 Zones에서 Add를 눌러 존을 만든다.\n\n- Name: 원하는 이름으로 한다. 여기서는 `wireguard`로 하였다.\n- Input/Output: Accept\n- Forward: Reject\n- Masquerading: 체크하라는데 뭔지는 모르겠다.\n- MSS clamping: 체크하라는데 뭔지는 모르겠다.\n- Covered Networks: 아까 만든 `wg0`\n- Allow forward to destination zones: 이 존에서 어떤 존으로 갈 수 있는 지를 묻는 것이다. VPN으로 접속시 내부 네트워크와 외부망을 모두 쓰고 싶으므로 `lan`, `wan`을 고른다\n- Allow forward to source zones: 외부망에서는 접근을 원치 않으므로 `lan`만 고른다.\n\n```\nconfig zone\n        option name 'wireguard'\n        option input 'ACCEPT'\n        option output 'ACCEPT'\n        option forward 'REJECT'\n        option masq '1'\n        option mtu_fix '1'\n        list network 'wg0'\n\nconfig forwarding\n        option src 'wireguard'\n        option dest 'lan'\n\nconfig forwarding\n        option src 'wireguard'\n        option dest 'wan'\n\nconfig forwarding\n        option src 'lan'\n        option dest 'wireguard'\n```\n\n이제 포트를 개방해줄 차례이다.\n\nTraffic Rules 탭에 들어가 Add를 누른다.\n\n- Name: 작명 규칙에 맞게 `Allow-Wireguard`로 하자.\n- Protocol: wireguard는 UDP를 사용하므로 UDP만 체크한다\n- Source zone: 외부에서의 접속이므로 `wan`에 체크한다.\n- Destination port: 기본 wireguard 포트인 51820을 쓴다.\n- Action: 당연히 accept\n","code":"var Component=(()=\u003e{var p=Object.create;var c=Object.defineProperty;var s=Object.getOwnPropertyDescriptor;var u=Object.getOwnPropertyNames;var w=Object.getPrototypeOf,g=Object.prototype.hasOwnProperty;var f=(r,n)=\u003e()=\u003e(n||r((n={exports:{}}).exports,n),n.exports),P=(r,n)=\u003e{for(var i in n)c(r,i,{get:n[i],enumerable:!0})},o=(r,n,i,l)=\u003e{if(n\u0026\u0026typeof n==\"object\"||typeof n==\"function\")for(let d of u(n))!g.call(r,d)\u0026\u0026d!==i\u0026\u0026c(r,d,{get:()=\u003en[d],enumerable:!(l=s(n,d))||l.enumerable});return r};var k=(r,n,i)=\u003e(i=r!=null?p(w(r)):{},o(n||!r||!r.__esModule?c(i,\"default\",{value:r,enumerable:!0}):i,r)),m=r=\u003eo(c({},\"__esModule\",{value:!0}),r);var a=f((A,t)=\u003e{t.exports=_jsx_runtime});var _={};P(_,{default:()=\u003eC,frontmatter:()=\u003eI});var e=k(a()),I={title:\"OpenWrt\",description:\"OpenWrt\\uB85C \\uB77C\\uC6B0\\uD130 \\uC368\\uBA39\\uAE30\",date:new Date(16777152e5),tags:null};function h(r){let n=Object.assign({h2:\"h2\",p:\"p\",a:\"a\",h3:\"h3\",pre:\"pre\",code:\"code\",ul:\"ul\",li:\"li\"},r.components);return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(n.h2,{children:\"Wireguard\\uB97C \\uC774\\uC6A9\\uD55C VPN \\uC124\\uC815\"}),`\n`,(0,e.jsx)(n.p,{children:\"VPN\\uC740 \\uACF5\\uAC1C \\uB124\\uD2B8\\uC6CC\\uD06C\\uC5D0\\uC11C \\uBE44\\uBC00 \\uB124\\uD2B8\\uC6CC\\uD06C\\uB85C \\uC811\\uC18D\\uD560 \\uB54C \\uC720\\uC6A9\\uD55C \\uBCF4\\uC548 \\uAE30\\uC220\\uC774\\uB2E4. \\uC774\\uB97C \\uC774\\uC6A9\\uD558\\uBA74 \\uC678\\uBD80\\uC5D0\\uC11C\\uB3C4 \\uD648 \\uB124\\uD2B8\\uC6CC\\uD06C\\uC5D0 \\uC548\\uC804\\uD558\\uACE0 \\uD3B8\\uB9AC\\uD558\\uAC8C \\uC811\\uC18D\\uD560 \\uC218 \\uC788\\uB2E4.\"}),`\n`,(0,e.jsx)(n.p,{children:\"\\uB2E4\\uC591\\uD55C \\uD504\\uB85C\\uD1A0\\uCF5C\\uC774 \\uC788\\uB294\\uB370, \\uCD5C\\uADFC \\uB9AC\\uB205\\uC2A4 \\uCEE4\\uB110(5.6)\\uC5D0 \\uD3EC\\uD568\\uB41C wireguard\\uAC00 \\uD3B8\\uB9AC\\uD558\\uB2E4.\"}),`\n`,(0,e.jsx)(n.p,{children:\"OpenWRT\\uB97C VPN \\uC11C\\uBC84\\uB85C \\uC774\\uC6A9\\uD560 \\uC218 \\uC788\\uB2E4.\"}),`\n`,(0,e.jsx)(n.p,{children:(0,e.jsx)(n.a,{href:\"https://openwrt.org/docs/guide-user/services/vpn/wireguard/basics\",children:\"WireGuard basics\"})}),`\n`,(0,e.jsx)(n.h3,{children:\"\\uC124\\uCE58\"}),`\n`,(0,e.jsx)(n.p,{children:\"wireguard \\uD504\\uB85C\\uD1A0\\uCF5C \\uC790\\uCCB4\\uB294 \\uCEE4\\uB110\\uC5D0 \\uD3EC\\uD568\\uB418\\uC5C8\\uC73C\\uB098, \\uAD00\\uB9AC\\uB3C4\\uAD6C\\uB294 \\uBCC4\\uB3C4\\uB85C \\uC124\\uCE58\\uD574\\uC57C\\uD55C\\uB2E4. LuCI\\uC5D0\\uC11C \\uD3B8\\uD788 \\uC4F0\\uACE0\\uC790 \\uC124\\uCE58\\uD558\\uB294 \\uAC70\\uB77C\\uC11C \\uC5C6\\uC5B4\\uB3C4 \\uBB34\\uBC29\\uD558\\uAE34 \\uD558\\uB2E4. SSH\\uB85C \\uC811\\uC18D\\uD558\\uC5EC \\uB2E4\\uC74C\\uC744 \\uC9C4\\uD589\\uD55C\\uB2E4:\"}),`\n`,(0,e.jsx)(n.pre,{children:(0,e.jsx)(n.code,{children:`opkg update\nopkg install luci-proto-wireguard luci-app-wireguard\n/etc/init.d/network restart\n`})}),`\n`,(0,e.jsx)(n.p,{children:\"\\uD639\\uC740 LuCI \\u2192 System \\u2192 Software\\uC5D0 \\uC811\\uC18D\\uD558\\uC5EC \\uB450 \\uD328\\uD0A4\\uC9C0\\uB97C \\uCC3E\\uC544 \\uC124\\uCE58\\uD55C\\uB2E4. \\uADF8 \\uD6C4 LuCI \\u2192 System \\u2192 Startup \\u2192 Initscripts \\u2192 network\\uC5D0\\uC11C restart\\uB97C \\uB204\\uB978\\uB2E4.\"}),`\n`,(0,e.jsx)(n.h3,{children:\"\\uD0A4\\uC30D \\uC0DD\\uC131\\uD558\\uAE30\"}),`\n`,(0,e.jsx)(n.p,{children:\"wireguard\\uB294 \\uACF5\\uAC1C\\uD0A4 \\uC554\\uD638\\uD654 \\uBC29\\uC2DD\\uC744 \\uC774\\uC6A9\\uD55C\\uB2E4. \\uB2E4\\uC74C \\uBA85\\uB839\\uC5B4\\uB85C \\uACF5\\uAC1C\\uD0A4 \\uC30D\\uC744 \\uC0DD\\uC131\\uD558\\uC790:\"}),`\n`,(0,e.jsx)(n.pre,{children:(0,e.jsx)(n.code,{children:`mkdir /etc/wireguard\ncd /etc/wireguard\nwg genkey | tee uibook | wg pubkey \u003e uibook.pub\nchmod 600 uibook\n`})}),`\n`,(0,e.jsxs)(n.p,{children:[(0,e.jsx)(n.code,{children:\"/etc/wireguard\"}),\"\\uB294 \\uD0A4 \\uC800\\uC7A5\\uC744 \\uC704\\uD558\\uC5EC \\uC784\\uC758\\uB85C \\uB9CC\\uB4E0 \\uACF5\\uAC04\\uC774\\uB2E4. \",(0,e.jsx)(n.code,{children:\"wg genkey\"}),\" \\uBA85\\uB839\\uC5B4\\uB85C \\uBE44\\uBC00\\uD0A4\\uB97C, \",(0,e.jsx)(n.code,{children:\"wg pubkey\"}),\" \\uBA85\\uB839\\uC5B4\\uB85C \\uACF5\\uAC1C\\uD0A4\\uB97C \\uB9CC\\uB4E0\\uB2E4. \\uADF8\\uC911 \\uBE44\\uBC00\\uD0A4\\uB294 \\uBC18\\uB4DC\\uC2DC \\uAD8C\\uD55C\\uC744 \",(0,e.jsx)(n.code,{children:\"600\"}),\"\\uC73C\\uB85C \\uC218\\uC815\\uD558\\uC790.\"]}),`\n`,(0,e.jsx)(n.h3,{children:\"\\uC778\\uD130\\uD398\\uC774\\uC2A4 \\uC0DD\\uC131\\uD558\\uAE30\"}),`\n`,(0,e.jsx)(n.p,{children:\"\\uC0C8\\uB85C\\uC6B4 \\uD504\\uB85C\\uD1A0\\uCF5C(wireguard)\\uB97C \\uC0AC\\uC6A9\\uD558\\uAE30 \\uB54C\\uBB38\\uC5D0, \\uD1B5\\uC2E0\\uC744 \\uC704\\uD574\\uC11C \\uC0C8\\uB85C\\uC6B4 \\uC778\\uD130\\uD398\\uC774\\uC2A4\\uB97C \\uC815\\uC758\\uD574\\uC57C\\uD55C\\uB2E4. LuCI \\u2192 Network \\u2192 Interfaces\\uC5D0\\uC11C \\uD560 \\uC218 \\uC788\\uB2E4.\"}),`\n`,(0,e.jsxs)(n.ul,{children:[`\n`,(0,e.jsx)(n.li,{children:\"\\uC774\\uB984: wg0. \\uADF8\\uB0E5 \\uC774\\uAC78 \\uC81C\\uC77C \\uB9CE\\uC774 \\uC4F0\\uB354\\uB77C.\"}),`\n`,(0,e.jsx)(n.li,{children:\"protocol: WireGuard VPN\"}),`\n`,(0,e.jsx)(n.li,{children:\"private key: \\uC544\\uAE4C \\uC0DD\\uC131\\uD55C \\uBE44\\uBC00\\uD0A4\"}),`\n`,(0,e.jsx)(n.li,{children:\"public key: \\uC544\\uAE4C \\uC0DD\\uC131\\uD55C \\uACF5\\uAC1C\\uD0A4\"}),`\n`,(0,e.jsx)(n.li,{children:\"listen port: 49152 ~ 65535\\uC5D0\\uC11C \\uACE0\\uB974\\uBA74 \\uB41C\\uB2E4\\uB294\\uB370 \\uADF8\\uB0E5 \\uB450\\uBA74 \\uB79C\\uB364 \\uB418\\uB294 \\uB4EF\"}),`\n`,(0,e.jsx)(n.li,{children:\"ip addresses: \\uD574\\uB2F9 \\uC778\\uD130\\uD398\\uC774\\uC2A4\\uC5D0 \\uD560\\uB2F9\\uD560 IP\\uC774\\uB2E4. 10.9.0.1/24\\uB85C \\uD588\\uB2E4. \\uC774 IP\\uAC00 \\uAC8C\\uC774\\uD2B8\\uC6E8\\uC774 \\uC5ED\\uD560\\uC744 \\uD55C\\uB2E4.\"}),`\n`]}),`\n`,(0,e.jsxs)(n.p,{children:[(0,e.jsx)(n.code,{children:\"/etc/config/network\"}),\" \\uD30C\\uC77C\\uC744 \\uD3B8\\uC9D1\\uD558\\uC5EC\\uC11C \\uD560 \\uC218\\uB3C4 \\uC788\\uB2E4. \\uC544\\uB798\\uCC98\\uB7FC \\uCD94\\uAC00\\uD558\\uBA74 \\uB41C\\uB2E4.\"]}),`\n`,(0,e.jsx)(n.pre,{children:(0,e.jsx)(n.code,{children:`config interface 'wg0'\n        option proto 'wireguard'\n        option private_key '[\\uBE44\\uBC00\\uD0A4 \\uB0B4\\uC6A9 \\uC785\\uB825]'\n        list addresses '10.9.0.1/24'\n`})}),`\n`,(0,e.jsx)(n.h3,{children:\"\\uD53C\\uC5B4 \\uC124\\uC815\\uD558\\uAE30\"}),`\n`,(0,e.jsx)(n.p,{children:\"\\uAC19\\uC740 \\uACF3\\uC5D0\\uC11C \\uD53C\\uC5B4 \\uC124\\uC815\\uB3C4 \\uAC19\\uC774 \\uC9C4\\uD589\\uD574\\uC57C \\uD55C\\uB2E4. \\uD53C\\uC5B4\\uB780 \\uC811\\uC18D\\uD558\\uACE0\\uC790 \\uD558\\uB294 \\uAE30\\uAE30\\uC774\\uB2E4. \\uC544\\uB798\\uC758 \\uC571\\uC744 \\uC774\\uC6A9\\uD558\\uBA74 \\uD3B8\\uB9AC\\uD558\\uAC8C \\uC811\\uC18D\\uD560 \\uC218 \\uC788\\uB2E4.\"}),`\n`,(0,e.jsx)(n.p,{children:(0,e.jsx)(n.a,{href:\"https://www.wireguard.com/install/\",children:\"Installation - WireGuard\"})}),`\n`,(0,e.jsx)(n.p,{children:\"\\uC811\\uC18D\\uC790\\uB3C4 \\uACF5\\uAC1C\\uD0A4/\\uBE44\\uBC00\\uD0A4 \\uC30D\\uC744 \\uB9CC\\uB4E4\\uACE0 \\uACF5\\uAC1C\\uD0A4\\uB97C wireguard \\uC11C\\uBC84\\uC5D0 \\uB4F1\\uB85D\\uD574\\uC57C\\uD55C\\uB2E4. \\uADF8\\uB7EC\\uB098 \\uC11C\\uBC84\\uC5D0\\uC11C \\uACF5\\uAC1C\\uD0A4/\\uBE44\\uBC00\\uD0A4\\uB97C \\uC0DD\\uC131\\uD558\\uACE0 \\uC774 \\uC790\\uCCB4\\uB97C \\uACF5\\uC720\\uD574\\uBC84\\uB9B4 \\uC218\\uB3C4 \\uC788\\uB2E4.\"}),`\n`,(0,e.jsxs)(n.p,{children:[\"\\uB530\\uB77C\\uC11C LuCI\\uC5D0\\uC11C \",(0,e.jsx)(n.code,{children:\"Generate new key pair\"}),\"\\uB85C \\uD0A4\\uC30D\\uC744 \\uB9CC\\uB4E4\\uC5B4\\uBC84\\uB9AC\\uACE0, \\uC124\\uC815\\uC744 \\uC644\\uB8CC\\uD55C \\uD6C4 \\uD574\\uB2F9 \\uC124\\uC815\\uC744 QR \\uCF54\\uB4DC\\uB098 conf \\uD30C\\uC77C \\uD615\\uD0DC\\uB85C \\uC811\\uC18D\\uC744 \\uC6D0\\uD558\\uB294 \\uD53C\\uC5B4\\uC5D0 \\uACF5\\uC720\\uD558\\uC5EC \\uB4F1\\uB85D\\uD558\\uBA74 \\uD3B8\\uD558\\uAC8C \\uD53C\\uC5B4\\uB97C \\uC124\\uC815\\uD560 \\uC218 \\uC788\\uB2E4. QR\\uCF54\\uB4DC\\uB85C \\uBCF4\\uAE30 \\uC704\\uD574\\uC11C\\uB294 qrencode \\uD328\\uD0A4\\uC9C0\\uB97C \\uC124\\uCE58\\uD574\\uC57C\\uD55C\\uB2E4.\"]}),`\n`,(0,e.jsxs)(n.ul,{children:[`\n`,(0,e.jsx)(n.li,{children:\"Public Key: \\uC811\\uC18D\\uD558\\uACE0\\uC790 \\uD558\\uB294 \\uC7A5\\uCE58\\uC758 \\uACF5\\uAC1C\\uD0A4\"}),`\n`,(0,e.jsx)(n.li,{children:\"Private Key: \\uC811\\uC18D\\uD558\\uACE0\\uC790 \\uD558\\uB294 \\uC7A5\\uCE58\\uC758 \\uBE44\\uBC00\\uD0A4. \\uC811\\uC18D\\uC5D0\\uB294 \\uD544\\uC694 \\uC5C6\\uC9C0\\uB9CC \\uC774\\uB97C \\uB123\\uC73C\\uBA74 \\uC124\\uC815\\uD30C\\uC77C \\uACF5\\uC720\\uD560 \\uB54C \\uD3B8\\uD574\\uC9C4\\uB2E4.\"}),`\n`,(0,e.jsx)(n.li,{children:\"Preshared Key: \\uC0AC\\uC2E4 \\uBB54\\uC9C0 \\uBAA8\\uB974\\uACA0\\uB2E4.\"}),`\n`,(0,e.jsx)(n.li,{children:\"Allowed IPs: \\uD53C\\uC5B4\\uAC00 \\uD130\\uB110 \\uC548\\uC5D0\\uC11C \\uC4F0\\uB3C4\\uB85D \\uD5C8\\uC6A9\\uD55C IP \\uB300\\uC5ED.\"}),`\n`,(0,e.jsx)(n.li,{children:\"Persistent Keep Alive: 25\\uAC00 \\uAD8C\\uC7A5\\uAC12\\uC778\\uB4EF\"}),`\n`]}),`\n`,(0,e.jsx)(n.pre,{children:(0,e.jsx)(n.code,{children:`config wireguard_wg0\n        option public_key 'cIDLafiUna6OyxWd4aCtmTpGt1XIaCGVzmfEuEC4nmQ='\n        option private_key '[\\uAC80\\uC5F4 \\uC0AD\\uC81C]'\n        option preshared_key '[\\uAC80\\uC5F4 \\uC0AD\\uC81C]'\n        list allowed_ips '10.9.0.0/24'\n        option persistent_keepalive '25'\n`})}),`\n`,(0,e.jsxs)(n.p,{children:[\"\\uC124\\uC815 \\uD6C4 \\uAC00\\uC7A5 \\uBC11\\uC758 \",(0,e.jsx)(n.code,{children:\"Generate configuration...\"}),\"\\uC744 \\uB204\\uB974\\uBA74 \\uC124\\uC815\\uC744 \\uD53C\\uC5B4\\uC5D0\\uAC8C \\uB0B4\\uBCF4\\uB0BC \\uC218 \\uC788\\uB2E4. \\uC774\\uB97C \\uBCF5\\uC0AC\\uD558\\uAC70\\uB098 QR\\uCF54\\uB4DC\\uB85C \\uCD2C\\uC601\\uD558\\uC5EC \\uB4F1\\uB85D\\uD55C\\uB2E4.\"]}),`\n`,(0,e.jsx)(n.pre,{children:(0,e.jsx)(n.code,{children:`[Interface]\nPrivateKey = \\uC774 \\uD074\\uB77C\\uC774\\uC5B8\\uD2B8\\uC758 \\uAC1C\\uC778\\uD0A4\nAddress = \\uD560\\uB2F9 \\uBC1B\\uC744 IP (\\uC608: 10.9.0.3/24)\nDNS = \\uB77C\\uC6B0\\uD130 DNS (192.168.1.1)\n\n[Peer]\nPublicKey = \\uC11C\\uBC84\\uC758 \\uACF5\\uAC1C\\uD0A4\nAllowedIPs = 0.0.0.0/0\nEndpoint = \\uC11C\\uBC84\\uC8FC\\uC18C:\\uD3EC\\uD2B8\n`})}),`\n`,(0,e.jsxs)(n.p,{children:[\"\\uC5EC\\uAE30\\uC11C \",(0,e.jsx)(n.code,{children:\"AllowedIPs\"}),\"\\uB294 VPN\\uC744 \\uAC70\\uCE60 IP\\uB97C \\uC758\\uBBF8\\uD55C\\uB2E4. \",(0,e.jsx)(n.code,{children:\"0.0.0.0/0\"}),`\\uC73C\\uB85C \\uB418\\uC5B4\\uC788\\uB2E4\\uBA74\n\\uBAA8\\uB4E0 \\uC811\\uC18D\\uC744 VPN\\uC744 \\uAC70\\uCCD0\\uC11C \\uD558\\uAC8C \\uB41C\\uB2E4.`]}),`\n`,(0,e.jsx)(n.h3,{children:\"\\uBC29\\uD654\\uBCBD \\uC124\\uC815\"}),`\n`,(0,e.jsxs)(n.p,{children:[\"\\uC774\\uC81C \\uBC29\\uD654\\uBCBD\\uC744 \\uAC1C\\uBC29\\uD574\\uC8FC\\uC5B4\\uC57C\\uD55C\\uB2E4. LuCI \\u2192 Network \\u2192 Firewall\\uC5D0\\uC11C \\uC124\\uC815 \\uD560 \\uC218 \\uC788\\uB2E4. \\uC774 \\uC791\\uC5C5\\uC740 \",(0,e.jsx)(n.code,{children:\"/etc/config/firewall\"}),\"\\uC744 \\uC218\\uC815\\uD558\\uC5EC\\uC11C \\uD560 \\uC218\\uB3C4 \\uC788\\uB2E4.\"]}),`\n`,(0,e.jsx)(n.p,{children:\"General Settings \\uD558\\uB2E8\\uC758 Zones\\uC5D0\\uC11C Add\\uB97C \\uB20C\\uB7EC \\uC874\\uC744 \\uB9CC\\uB4E0\\uB2E4.\"}),`\n`,(0,e.jsxs)(n.ul,{children:[`\n`,(0,e.jsxs)(n.li,{children:[\"Name: \\uC6D0\\uD558\\uB294 \\uC774\\uB984\\uC73C\\uB85C \\uD55C\\uB2E4. \\uC5EC\\uAE30\\uC11C\\uB294 \",(0,e.jsx)(n.code,{children:\"wireguard\"}),\"\\uB85C \\uD558\\uC600\\uB2E4.\"]}),`\n`,(0,e.jsx)(n.li,{children:\"Input/Output: Accept\"}),`\n`,(0,e.jsx)(n.li,{children:\"Forward: Reject\"}),`\n`,(0,e.jsx)(n.li,{children:\"Masquerading: \\uCCB4\\uD06C\\uD558\\uB77C\\uB294\\uB370 \\uBB54\\uC9C0\\uB294 \\uBAA8\\uB974\\uACA0\\uB2E4.\"}),`\n`,(0,e.jsx)(n.li,{children:\"MSS clamping: \\uCCB4\\uD06C\\uD558\\uB77C\\uB294\\uB370 \\uBB54\\uC9C0\\uB294 \\uBAA8\\uB974\\uACA0\\uB2E4.\"}),`\n`,(0,e.jsxs)(n.li,{children:[\"Covered Networks: \\uC544\\uAE4C \\uB9CC\\uB4E0 \",(0,e.jsx)(n.code,{children:\"wg0\"})]}),`\n`,(0,e.jsxs)(n.li,{children:[\"Allow forward to destination zones: \\uC774 \\uC874\\uC5D0\\uC11C \\uC5B4\\uB5A4 \\uC874\\uC73C\\uB85C \\uAC08 \\uC218 \\uC788\\uB294 \\uC9C0\\uB97C \\uBB3B\\uB294 \\uAC83\\uC774\\uB2E4. VPN\\uC73C\\uB85C \\uC811\\uC18D\\uC2DC \\uB0B4\\uBD80 \\uB124\\uD2B8\\uC6CC\\uD06C\\uC640 \\uC678\\uBD80\\uB9DD\\uC744 \\uBAA8\\uB450 \\uC4F0\\uACE0 \\uC2F6\\uC73C\\uBBC0\\uB85C \",(0,e.jsx)(n.code,{children:\"lan\"}),\", \",(0,e.jsx)(n.code,{children:\"wan\"}),\"\\uC744 \\uACE0\\uB978\\uB2E4\"]}),`\n`,(0,e.jsxs)(n.li,{children:[\"Allow forward to source zones: \\uC678\\uBD80\\uB9DD\\uC5D0\\uC11C\\uB294 \\uC811\\uADFC\\uC744 \\uC6D0\\uCE58 \\uC54A\\uC73C\\uBBC0\\uB85C \",(0,e.jsx)(n.code,{children:\"lan\"}),\"\\uB9CC \\uACE0\\uB978\\uB2E4.\"]}),`\n`]}),`\n`,(0,e.jsx)(n.pre,{children:(0,e.jsx)(n.code,{children:`config zone\n        option name 'wireguard'\n        option input 'ACCEPT'\n        option output 'ACCEPT'\n        option forward 'REJECT'\n        option masq '1'\n        option mtu_fix '1'\n        list network 'wg0'\n\nconfig forwarding\n        option src 'wireguard'\n        option dest 'lan'\n\nconfig forwarding\n        option src 'wireguard'\n        option dest 'wan'\n\nconfig forwarding\n        option src 'lan'\n        option dest 'wireguard'\n`})}),`\n`,(0,e.jsx)(n.p,{children:\"\\uC774\\uC81C \\uD3EC\\uD2B8\\uB97C \\uAC1C\\uBC29\\uD574\\uC904 \\uCC28\\uB840\\uC774\\uB2E4.\"}),`\n`,(0,e.jsx)(n.p,{children:\"Traffic Rules \\uD0ED\\uC5D0 \\uB4E4\\uC5B4\\uAC00 Add\\uB97C \\uB204\\uB978\\uB2E4.\"}),`\n`,(0,e.jsxs)(n.ul,{children:[`\n`,(0,e.jsxs)(n.li,{children:[\"Name: \\uC791\\uBA85 \\uADDC\\uCE59\\uC5D0 \\uB9DE\\uAC8C \",(0,e.jsx)(n.code,{children:\"Allow-Wireguard\"}),\"\\uB85C \\uD558\\uC790.\"]}),`\n`,(0,e.jsx)(n.li,{children:\"Protocol: wireguard\\uB294 UDP\\uB97C \\uC0AC\\uC6A9\\uD558\\uBBC0\\uB85C UDP\\uB9CC \\uCCB4\\uD06C\\uD55C\\uB2E4\"}),`\n`,(0,e.jsxs)(n.li,{children:[\"Source zone: \\uC678\\uBD80\\uC5D0\\uC11C\\uC758 \\uC811\\uC18D\\uC774\\uBBC0\\uB85C \",(0,e.jsx)(n.code,{children:\"wan\"}),\"\\uC5D0 \\uCCB4\\uD06C\\uD55C\\uB2E4.\"]}),`\n`,(0,e.jsx)(n.li,{children:\"Destination port: \\uAE30\\uBCF8 wireguard \\uD3EC\\uD2B8\\uC778 51820\\uC744 \\uC4F4\\uB2E4.\"}),`\n`,(0,e.jsx)(n.li,{children:\"Action: \\uB2F9\\uC5F0\\uD788 accept\"}),`\n`]})]})}function y(r={}){let{wrapper:n}=r.components||{};return n?(0,e.jsx)(n,Object.assign({},r,{children:(0,e.jsx)(h,r)})):h(r)}var C=y;return m(_);})();\n;return Component;"},"_id":"openwrt.md","_raw":{"sourceFilePath":"openwrt.md","sourceFileName":"openwrt.md","sourceFileDir":".","contentType":"markdown","flattenedPath":"openwrt"},"type":"Note","slug":"openwrt"}},"__N_SSG":true},"page":"/n/[[...slug]]","query":{"slug":["openwrt"]},"buildId":"GlTOjBOhO6xWONgruXGi2","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>